<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOS PLACA</title>
  <link rel="icon" type="image/png" href="logo.png">

  <!-- Fontes -->
  <style>
    @font-face { font-family: 'JostBold'; src: url('jostbold.ttf'); }
    @font-face { font-family: 'JostRegular'; src: url('jostregular.ttf'); }
    @font-face { font-family: 'UrbanistRegular'; src: url('urbanistregular.ttf'); }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'JostRegular', sans-serif; }
    body { background-color: #FAFAFA; color: #333; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    header {
      background-color: #0077B6;
      color: white;
      padding: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 0 0 10px 10px;
    }
    .logo-container { display: flex; align-items: center; gap: 10px; }
    .logo-img { width: 50px; height: 50px; }
    .logo-text { font-size: 2rem; font-family: 'JostBold'; }
    .screen {
      background-color: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 1.25rem;
      display: none;
    }
    .screen.active { display: block; }
    .btn {
      background-color: #023E8A;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.625rem 0.3125rem;
    }
    .btn-success { background-color: #F8961E; }
    .btn-secondary { background-color: #ADB5BD; }
    .form-group { margin-bottom: 1.25rem; }
    label { display: block; margin-bottom: 0.5rem; }
    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    .result {
      margin-top: 1rem;
      padding: 0.9375rem;
      border-radius: 6px;
      background-color: #f8f9fa;
      display: none;
    }
    .alert-box {
      background-color: #fff8e1;
      border-left: 6px solid #f1c40f;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    footer {
      background-color: #023E8A;
      color: white;
      padding: 15px;
      text-align: center;
      border-radius: 10px 10px 0 0;
      margin-top: 30px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
</head>

<body>

<header>
  <div class="logo-container">
    <img src="logo.png" alt="Logo SOS Placa" class="logo-img">
    <div class="logo-text">SOS PLACA</div>
  </div>
  <a href="https://play.google.com/store/apps/details?id=seu.id.aqui" target="_blank">
    <img src="GooglePlay.png" alt="Baixar na Google Play" style="height: 50px;">
  </a>
</header>

<div class="container">

  <!-- Menu Inicial -->
  <div id="menu-screen" class="screen active">
    <h2>O que voc√™ deseja fazer?</h2>
    <button id="btn-perdi" class="btn">Perdi uma placa</button>
    <button id="btn-achei" class="btn">Achei uma placa</button>
    <button id="btn-minhas-placas" class="btn" style="display: none;">Minhas Placas</button>
    <button id="btn-perfil" class="btn" style="display: none;">Perfil</button>
    <button id="btn-login" class="btn btn-success">Login / Registro</button>
  </div>

  <!-- Tela Login -->
  <div id="login-screen" class="screen">
    <h2>Entre com sua conta!</h2>
    <div class="form-group">
      <label for="login-email">Email:</label>
      <input type="email" id="login-email" placeholder="Digite seu email">
    </div>
    <div class="form-group">
      <label for="login-senha">Senha:</label>
      <input type="password" id="login-senha" placeholder="Digite sua senha">
    </div>
    <div>
      <button id="login-btn" class="btn btn-success">Entrar</button>
      <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    </div>
    <p style="margin-top: 15px;">N√£o tem uma conta? <a href="#" id="link-registro">Crie uma aqui!</a></p>
    <div id="login-result" class="result"></div>
  </div>

  <!-- Tela Registro -->
  <div id="registro-screen" class="screen">
    <h2>Registrar-se</h2>
    <div class="form-group">
      <label for="registro-nome">Nome:</label>
      <input type="text" id="registro-nome" placeholder="Seu nome completo">
    </div>
    <div class="form-group">
      <label for="registro-email">Email:</label>
      <input type="email" id="registro-email" placeholder="Digite seu email">
    </div>
    <div class="form-group">
      <label for="registro-telefone">Telefone:</label>
      <input type="tel" id="registro-telefone" placeholder="(00) 00000-0000">
    </div>
    <div class="form-group">
      <label for="registro-senha">Senha:</label>
      <input type="password" id="registro-senha" placeholder="Crie uma senha">
    </div>
    <div class="form-group">
      <label for="registro-confirmar">Confirmar Senha:</label>
      <input type="password" id="registro-confirmar" placeholder="Confirme sua senha">
    </div>
    <div>
      <button id="registro-btn" class="btn btn-success">Registrar-se</button>
      <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    </div>
    <div id="registro-result" class="result"></div>
  </div>

  <!-- Tela Perfil -->
  <div id="perfil-screen" class="screen">
    <h2>Meu Perfil</h2>
    <p><strong>Nome:</strong> <span id="perfil-nome"></span></p>
    <p><strong>Email:</strong> <span id="perfil-email"></span></p>
    <p><strong>Telefone:</strong> <span id="perfil-telefone"></span></p>
    <div style="margin-top: 20px;">
      <button id="logout-btn" class="btn btn-secondary">Sair</button>
      <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    </div>
  </div>

  <!-- Tela Minhas Placas -->
  <div id="minhas-placas-screen" class="screen">
    <h2>Minhas Placas Cadastradas como Perdidas</h2>
    <div id="lista-minhas-placas"></div>
    <div style="margin-top: 20px;">
      <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    </div>
  </div>
  <!-- Tela Perdi uma Placa -->
  <div id="perdi-screen" class="screen">
    <h2>Perdi uma Placa</h2>
    <div class="form-group">
      <label>Tipo de placa:</label>
      <div style="display: flex; gap: 0.625rem;">
        <button id="btn-perdi-comum" class="btn ativo">Comum</button>
        <button id="btn-perdi-mercosul" class="btn">Mercosul</button>
      </div>
    </div>
    <div class="form-group">
      <label for="perdi-placa">N√∫mero da placa:</label>
      <input type="text" id="perdi-placa" placeholder="AAA-0000 ou AAA0A00">
    </div>
    <div class="form-group" id="perdi-localizacao">
      <label for="perdi-uf">UF:</label>
      <select id="perdi-uf">
        <option value="" disabled selected>Selecione o estado</option>
      </select>
      <label for="perdi-municipio">Munic√≠pio:</label>
      <select id="perdi-municipio">
        <option value="" disabled selected>Selecione o munic√≠pio</option>
      </select>
    </div>
    <div>
      <button id="perdi-verificar" class="btn btn-success">Verificar Placa</button>
      <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    </div>
    <div id="perdi-result" class="result"></div>
  </div>

  <!-- Tela Achei uma Placa -->
  <div id="achei-screen" class="screen">
    <h2>Cadastrar placa encontrada</h2>
    <div class="form-group">
      <label>Tipo de placa:</label>
      <div style="display: flex; gap: 0.625rem;">
        <button id="btn-achei-comum" class="btn ativo">Comum</button>
        <button id="btn-achei-mercosul" class="btn">Mercosul</button>
      </div>
    </div>
    <div class="form-group">
      <label for="achei-placa">N√∫mero da placa:</label>
      <input type="text" id="achei-placa" placeholder="AAA-0000 ou AAA0A00">
    </div>
    <div class="form-group">
      <label>Capturar imagem da placa:</label>
      <input type="file" accept="image/*" capture="environment" id="ocr-input">
      <button class="btn btn-secondary" id="ocr-btn">Ler Placa pela C√¢mera</button>
    </div>
    <div class="form-group" id="achei-localizacao">
      <label for="achei-uf">UF:</label>
      <select id="achei-uf">
        <option value="" disabled selected>Selecione o estado</option>
      </select>
      <label for="achei-municipio">Munic√≠pio:</label>
      <select id="achei-municipio">
        <option value="" disabled selected>Selecione o munic√≠pio</option>
      </select>
    </div>
    <div class="form-group">
      <label for="achei-nome">Seu nome:</label>
      <input type="text" id="achei-nome" placeholder="Digite seu nome completo">
    </div>
    <div class="form-group">
      <label for="achei-telefone">Seu telefone:</label>
      <input type="tel" id="achei-telefone" placeholder="(00) 00000-0000">
    </div>
    <div>
      <button id="achei-salvar" class="btn btn-success">Salvar Placa</button>
      <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    </div>
    <div id="achei-result" class="result"></div>
  </div>

  <!-- Rodap√© -->
  <footer>
    üíô Ajude a manter esse projeto!<br>
    <strong>PIX:</strong> sosplaca.app@gmail.com
  </footer>

</div> <!-- Fecha container -->

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  signOut, 
  onAuthStateChanged, 
  updateProfile 
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  databaseURL: "SEU_DATABASE_URL",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_STORAGE_BUCKET",
  messagingSenderId: "SEU_MESSAGING_SENDER_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const firestore = getFirestore(app);
const realtimeDb = getDatabase(app);
const auth = getAuth(app);
// üîÄ Navega√ß√£o
function mostrarTela(id) {
  document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function voltarMenu() {
  mostrarTela('menu-screen');
}
window.voltarMenu = voltarMenu;

// üîó Links Login ‚Üî Registro
document.getElementById('link-registro').addEventListener('click', () => {
  mostrarTela('registro-screen');
});

// üéØ Bot√µes do menu
document.getElementById('btn-achei').addEventListener('click', () => mostrarTela('achei-screen'));
document.getElementById('btn-perdi').addEventListener('click', () => mostrarTela('perdi-screen'));
document.getElementById('btn-minhas-placas').addEventListener('click', () => mostrarTela('minhas-placas-screen'));
document.getElementById('btn-perfil').addEventListener('click', () => mostrarTela('perfil-screen'));
document.getElementById('btn-login').addEventListener('click', () => mostrarTela('login-screen'));

// üîë Autentica√ß√£o
onAuthStateChanged(auth, async (user) => {
  const btnMinhasPlacas = document.getElementById('btn-minhas-placas');
  const btnPerfil = document.getElementById('btn-perfil');
  const btnLogin = document.getElementById('btn-login');

  if (user) {
    btnMinhasPlacas.style.display = 'inline-block';
    btnPerfil.style.display = 'inline-block';
    btnLogin.style.display = 'none';

    const q = query(collection(firestore, "users"), where("uid", "==", user.uid));
    const querySnapshot = await getDocs(q);
    if (!querySnapshot.empty) {
      const data = querySnapshot.docs[0].data();
      document.getElementById('perfil-nome').textContent = data.nome;
      document.getElementById('perfil-email').textContent = data.email;
      document.getElementById('perfil-telefone').textContent = data.telefone;
    } else {
      document.getElementById('perfil-nome').textContent = user.displayName;
      document.getElementById('perfil-email').textContent = user.email;
      document.getElementById('perfil-telefone').textContent = '(n√£o informado)';
    }
  } else {
    btnMinhasPlacas.style.display = 'none';
    btnPerfil.style.display = 'none';
    btnLogin.style.display = 'inline-block';
  }
});
// üî• M√°scara de telefone
document.getElementById('achei-telefone').addEventListener('input', function() {
  let value = this.value.replace(/\D/g, '').slice(0, 11);
  if (value.length > 2) value = `(${value.substring(0, 2)}) ${value.substring(2)}`;
  if (value.length > 10) value = `${value.substring(0, 10)}-${value.substring(10)}`;
  this.value = value;
});

// üî• M√°scara de placas
function aplicarMascaraPlaca(inputId, isComum) {
  const input = document.getElementById(inputId);
  let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
  if (isComum) {
    value = value.slice(0, 7);
    if (value.length > 3) value = `${value.slice(0, 3)}-${value.slice(3)}`;
  } else {
    value = value.slice(0, 7);
  }
  input.value = value;
}

document.getElementById('achei-placa').addEventListener('input', function() {
  const isComum = document.getElementById('btn-achei-comum').classList.contains('ativo');
  aplicarMascaraPlaca('achei-placa', isComum);
});

document.getElementById('perdi-placa').addEventListener('input', function() {
  const isComum = document.getElementById('btn-perdi-comum').classList.contains('ativo');
  aplicarMascaraPlaca('perdi-placa', isComum);
});

// üî• UF ‚Üí Munic√≠pio din√¢mico
const cidadesPorEstado = {
  SP: ["Ubatuba", "Caraguatatuba", "S√£o Paulo", "Campinas"],
  RJ: ["Rio de Janeiro", "Niter√≥i", "Petr√≥polis"],
  MG: ["Belo Horizonte", "Uberl√¢ndia", "Contagem"],
};

function atualizarMunicipios(ufId, municipioId) {
  const uf = document.getElementById(ufId).value;
  const municipioSelect = document.getElementById(municipioId);
  municipioSelect.innerHTML = '<option value="" disabled selected>Selecione o munic√≠pio</option>';

  if (cidadesPorEstado[uf]) {
    cidadesPorEstado[uf].forEach(cidade => {
      const option = document.createElement('option');
      option.value = cidade;
      option.textContent = cidade;
      municipioSelect.appendChild(option);
    });
  }
}

document.getElementById('achei-uf').addEventListener('change', () => {
  atualizarMunicipios('achei-uf', 'achei-municipio');
});
document.getElementById('perdi-uf').addEventListener('change', () => {
  atualizarMunicipios('perdi-uf', 'perdi-municipio');
});

// üî• Bot√µes tipo de placa
document.querySelectorAll('#btn-achei-comum, #btn-achei-mercosul').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('#achei-screen .btn').forEach(b => b.classList.remove('ativo'));
    this.classList.add('ativo');
    const isComum = this.id === 'btn-achei-comum';
    document.getElementById('achei-placa').placeholder = isComum ? 'AAA-0000' : 'AAA0A00';
    document.getElementById('achei-localizacao').style.display = isComum ? 'block' : 'none';
  });
});

document.querySelectorAll('#btn-perdi-comum, #btn-perdi-mercosul').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('#perdi-screen .btn').forEach(b => b.classList.remove('ativo'));
    this.classList.add('ativo');
    const isComum = this.id === 'btn-perdi-comum';
    document.getElementById('perdi-placa').placeholder = isComum ? 'AAA-0000' : 'AAA0A00';
    document.getElementById('perdi-localizacao').style.display = isComum ? 'block' : 'none';
  });
});

// üî• OCR ‚Äî Ler placa pela c√¢mera
document.getElementById('ocr-btn').addEventListener('click', () => {
  const file = document.getElementById('ocr-input').files[0];
  if (!file) {
    alert('Por favor, selecione ou tire uma foto da placa.');
    return;
  }
  Tesseract.recognize(
    file,
    'eng',
    { logger: m => console.log(m) }
  ).then(({ data: { text } }) => {
    const resultado = text.toUpperCase().replace(/[^A-Z0-9]/g, '').trim();
    if (resultado) {
      document.getElementById('achei-placa').value = resultado;
      alert('Texto reconhecido: ' + resultado);
    } else {
      alert('N√£o foi poss√≠vel reconhecer a placa. Tente novamente.');
    }
  }).catch(err => {
    alert('Erro ao processar a imagem.');
  });
});
