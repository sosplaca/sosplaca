<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Placa</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', sans-serif;
}
body {
  background-color: #f5f5f5;
  padding-bottom: 60px;
}
header {
  background-color: #0072bb;
  color: white;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.logo-container {
  display: flex;
  align-items: center;
}
.logo-img {
  width: 40px;
  margin-right: 10px;
}
.play-img {
  width: 100px;
}
.screen {
  display: none;
  padding: 20px;
}
.screen.active {
  display: block;
}
.card {
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  max-width: 400px;
  margin: 30px auto;
  text-align: center;
}
h2 {
  margin-bottom: 20px;
  color: #004d80;
}
p {
  margin-bottom: 15px;
  color: #333;
}
.btn {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  margin-bottom: 10px;
  transition: all 0.3s;
}
.btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}
.btn-primary {
  background-color: #004d80;
  color: white;
}
.btn-orange {
  background-color: #ff9800;
  color: white;
}
.btn-red {
  background-color: #e53935;
  color: white;
}
.btn-secondary {
  background-color: #cccccc;
  color: #333333;
}
a {
  color: #0072bb;
  text-decoration: none;
}
.result {
  color: red;
  margin-top: 10px;
  font-size: 14px;
}
footer {
  background-color: #003b66;
  color: white;
  padding: 10px;
  text-align: center;
  font-size: 14px;
  position: fixed;
  bottom: 0;
  width: 100%;
}
footer a {
  color: white;
  text-decoration: underline;
}
.form-group {
  margin-bottom: 15px;
  text-align: left;
}
.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #004d80;
}
.form-group input, .form-group textarea, .form-group select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}
.placa-item {
  background: #f0f8ff;
  margin: 10px 0;
  padding: 15px;
  border-radius: 8px;
  border-left: 4px solid #004d80;
}
.placa-item h3 {
  color: #004d80;
  margin-bottom: 5px;
}
</style>
</head>
<body>

<!-- üèÅ Cabe√ßalho -->
<header>
  <div class="logo-container">
    <img src="logo.png" alt="Logo SOS Placa" class="logo-img">
    <div class="logo-text"><strong>SOS PLACA</strong></div>
  </div>
  <a href="https://play.google.com/store/apps/details?id=seu.app" target="_blank">
    <img src="GooglePlay.png" alt="Google Play" class="play-img">
  </a>
</header>
<!-- üî• Menu Inicial -->
<div id="menu-screen" class="screen active">
  <div class="card">
    <h2>O que voc√™ deseja fazer?</h2>
    <button class="btn btn-primary" onclick="mostrarTela('placas-screen')">Buscar / Cadastrar Placas</button>
    <button class="btn btn-primary" onclick="verificarLogin('minhas-placas-screen')">Minhas Placas</button>
    <button class="btn btn-primary" onclick="verificarLogin('perfil-screen')">Perfil</button>
  </div>
</div>

<!-- üöó Tela Placas -->
<div id="placas-screen" class="screen">
  <div class="card">
    <h2>O que voc√™ deseja fazer?</h2>
    <button class="btn btn-primary" onclick="mostrarTela('perdi-placa-screen')">Perdi uma placa</button>
    <button class="btn btn-primary" onclick="mostrarTela('achei-placa-screen')">Achei uma placa</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar ao Menu</button>
  </div>
</div>

<!-- üè∑Ô∏è Tela Perdi Placa -->
<div id="perdi-placa-screen" class="screen">
  <div class="card">
    <h2>Cadastrar placa perdida</h2>
    <div class="form-group">
      <label>N√∫mero da placa*</label>
      <input type="text" id="placa-perdida" placeholder="ABC1D23" maxlength="7">
    </div>
    <div class="form-group">
      <label>Local onde perdeu</label>
      <input type="text" id="local-perda" placeholder="Ex: Rua Principal, 100 - Centro">
    </div>
    <div class="form-group">
      <label>Data aproximada</label>
      <input type="date" id="data-perda">
    </div>
    <div class="form-group">
      <label>Descri√ß√£o (opcional)</label>
      <textarea id="descricao-perda" rows="3" placeholder="Detalhes adicionais"></textarea>
    </div>
    <button class="btn btn-primary" id="cadastrar-perda-btn">Cadastrar Placa Perdida</button>
    <button class="btn btn-secondary" onclick="voltarPara('placas-screen')">Voltar</button>
    <div id="perdi-placa-result" class="result"></div>
  </div>
</div>

<!-- üîç Tela Achei Placa -->
<div id="achei-placa-screen" class="screen">
  <div class="card">
    <h2>Informar placa encontrada</h2>
    <div class="form-group">
      <label>N√∫mero da placa encontrada*</label>
      <input type="text" id="placa-achada" placeholder="ABC1D23" maxlength="7">
    </div>
    <div class="form-group">
      <label>Local onde encontrou*</label>
      <input type="text" id="local-achado" placeholder="Ex: Av. Central, 500">
    </div>
    <div class="form-group">
      <label>Data*</label>
      <input type="date" id="data-achado">
    </div>
    <div class="form-group">
      <label>Como posso devolver?*</label>
      <select id="contato-achado">
        <option value="">Selecione uma op√ß√£o</option>
        <option value="whatsapp">WhatsApp</option>
        <option value="email">E-mail</option>
        <option value="telefone">Telefone</option>
      </select>
    </div>
    <button class="btn btn-primary" id="cadastrar-achado-btn">Informar Placa Encontrada</button>
    <button class="btn btn-secondary" onclick="voltarPara('placas-screen')">Voltar</button>
    <div id="achei-placa-result" class="result"></div>
  </div>
</div>
<!-- üîê Tela Login -->
<div id="login-screen" class="screen">
  <div class="card">
    <h2>Entre com sua conta</h2>
    <div class="form-group">
      <label for="login-email">E-mail</label>
      <input type="email" id="login-email" placeholder="email@exemplo.com">
    </div>
    <div class="form-group">
      <label for="login-senha">Senha</label>
      <input type="password" id="login-senha" placeholder="Sua senha">
    </div>
    <p>N√£o tem uma conta? <a href="#" onclick="mostrarTela('registro-screen')">Crie uma aqui!</a></p>
    <button class="btn btn-orange" id="login-btn">Entrar</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar ao Menu</button>
    <div id="login-result" class="result"></div>
  </div>
</div>

<!-- üÜï Tela Registro -->
<div id="registro-screen" class="screen">
  <div class="card">
    <h2>Criar nova conta</h2>
    <div class="form-group">
      <label>Nome completo*</label>
      <input type="text" id="registro-nome" placeholder="Seu nome completo">
    </div>
    <div class="form-group">
      <label>E-mail*</label>
      <input type="email" id="registro-email" placeholder="email@exemplo.com">
    </div>
    <div class="form-group">
      <label>Telefone*</label>
      <input type="tel" id="registro-telefone" placeholder="(99) 99999-9999">
    </div>
    <div class="form-group">
      <label>Senha* (m√≠nimo 6 caracteres)</label>
      <input type="password" id="registro-senha" placeholder="Crie uma senha">
    </div>
    <div class="form-group">
      <label>Confirme a senha*</label>
      <input type="password" id="registro-confirmar" placeholder="Repita a senha">
    </div>
    <button class="btn btn-orange" id="registro-btn">Criar Conta</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar ao Menu</button>
    <div id="registro-result" class="result"></div>
  </div>
</div>

<!-- üë§ Tela Perfil (logado) -->
<div id="perfil-screen" class="screen">
  <div class="card">
    <h2>Meu Perfil</h2>
    <div class="placa-item">
      <p><strong>Nome:</strong> <span id="perfil-nome"></span></p>
      <p><strong>E-mail:</strong> <span id="perfil-email"></span></p>
      <p><strong>Telefone:</strong> <span id="perfil-telefone"></span></p>
    </div>
    <button class="btn btn-red" id="logout-btn">Sair da Conta</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar ao Menu</button>
  </div>
</div>

<!-- üìã Tela Minhas Placas (logado) -->
<div id="minhas-placas-screen" class="screen">
  <div class="card">
    <h2>Minhas Placas Perdidas</h2>
    <div id="lista-minhas-placas">
      <p>Carregando suas placas...</p>
    </div>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar ao Menu</button>
  </div>
</div>
<footer>
  <p>SOS Placa &copy; 2023 - <a href="#" onclick="mostrarTela('sobre-screen')">Sobre o projeto</a></p>
</footer>

<!-- üöÄ Scripts -->
<script type="module">
// Configura√ß√£o do Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, updateDoc, doc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  signOut, 
  onAuthStateChanged,
  updateProfile
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBjetihGmlo_z01jx-GW9Ith0oDCS0jwYc",
  authDomain: "sosplaca-73cf7.firebaseapp.com",
  databaseURL: "https://sosplaca-73cf7-default-rtdb.firebaseio.com",
  projectId: "sosplaca-73cf7",
  storageBucket: "sosplaca-73cf7.appspot.com",
  messagingSenderId: "658059385722",
  appId: "1:658059385722:web:5ed0e8fd7f7a2931d894c3"
};

const app = initializeApp(firebaseConfig);
const firestore = getFirestore(app);
const auth = getAuth(app);

// Fun√ß√µes de navega√ß√£o
function mostrarTela(id) {
  document.querySelectorAll('.screen').forEach(screen => {
    screen.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}

function voltarMenu() {
  mostrarTela('menu-screen');
}

function voltarPara(id) {
  mostrarTela(id);
}

function verificarLogin(telaDestino) {
  if (auth.currentUser) {
    mostrarTela(telaDestino);
  } else {
    mostrarTela('login-screen');
    document.getElementById('login-screen').setAttribute('data-redirect', telaDestino);
  }
}

window.mostrarTela = mostrarTela;
window.voltarMenu = voltarMenu;
window.voltarPara = voltarPara;
window.verificarLogin = verificarLogin;

// [Continua...]
</script>
<script type="module">
// [Continua√ß√£o do script...]

// Login
document.getElementById('login-btn').addEventListener('click', async () => {
  const email = document.getElementById('login-email').value.trim();
  const senha = document.getElementById('login-senha').value.trim();
  const result = document.getElementById('login-result');
  
  if (!email || !senha) {
    result.textContent = 'Preencha todos os campos.';
    return;
  }

  try {
    await signInWithEmailAndPassword(auth, email, senha);
    result.textContent = 'Login realizado com sucesso!';
    
    const redirect = document.getElementById('login-screen').getAttribute('data-redirect');
    setTimeout(() => mostrarTela(redirect || 'menu-screen'), 1000);
  } catch (error) {
    result.textContent = 'E-mail ou senha incorretos. Tente novamente.';
  }
});

// Registro
document.getElementById('registro-btn').addEventListener('click', async () => {
  const nome = document.getElementById('registro-nome').value.trim();
  const email = document.getElementById('registro-email').value.trim();
  const telefone = document.getElementById('registro-telefone').value.trim();
  const senha = document.getElementById('registro-senha').value.trim();
  const confirmar = document.getElementById('registro-confirmar').value.trim();
  const result = document.getElementById('registro-result');
  
  // Valida√ß√µes
  if (!nome || !email || !telefone || !senha || !confirmar) {
    result.textContent = 'Preencha todos os campos obrigat√≥rios.';
    return;
  }
  if (senha.length < 6) {
    result.textContent = 'A senha deve ter no m√≠nimo 6 caracteres.';
    return;
  }
  if (senha !== confirmar) {
    result.textContent = 'As senhas n√£o coincidem.';
    return;
  }

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
    await updateProfile(userCredential.user, { displayName: nome });
    
    await addDoc(collection(firestore, "users"), {
      uid: userCredential.user.uid,
      nome: nome,
      email: email,
      telefone: telefone
    });

    result.textContent = 'Conta criada com sucesso!';
    setTimeout(() => mostrarTela('menu-screen'), 1500);
  } catch (error) {
    result.textContent = 'Erro ao criar conta. Este e-mail j√° est√° em uso.';
  }
});

// Logout
document.getElementById('logout-btn').addEventListener('click', async () => {
  await signOut(auth);
  voltarMenu();
});

// M√°scara de telefone
document.getElementById('registro-telefone').addEventListener('input', function(e) {
  let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
  e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
});

// Cadastrar placa perdida (n√£o requer login)
document.getElementById('cadastrar-perda-btn').addEventListener('click', async () => {
  const placa = document.getElementById('placa-perdida').value.trim().toUpperCase();
  const local = document.getElementById('local-perda').value.trim();
  const data = document.getElementById('data-perda').value;
  const descricao = document.getElementById('descricao-perda').value.trim();
  const result = document.getElementById('perdi-placa-result');
  
  if (!placa || placa.length < 6) {
    result.textContent = 'Informe uma placa v√°lida (m√≠nimo 6 caracteres).';
    return;
  }

  try {
    const placaData = {
      plate: placa,
      location: local,
      date: data,
      description: descricao,
      status: 'perdida',
      createdAt: new Date()
    };

    // Se o usu√°rio estiver logado, associamos a ele
    if (auth.currentUser) {
      placaData.ownerId = auth.currentUser.uid;
      placaData.ownerEmail = auth.currentUser.email;
    }

    await addDoc(collection(firestore, "lostPlates"), placaData);
    
    result.textContent = 'Placa cadastrada com sucesso!';
    setTimeout(() => voltarPara('placas-screen'), 1500);
  } catch (error) {
    result.textContent = 'Erro ao cadastrar placa. Tente novamente.';
  }
});

// [Continua...]
</script>
<script type="module">
// [Continua√ß√£o do script...]

// Cadastrar placa achada (n√£o requer login)
document.getElementById('cadastrar-achado-btn').addEventListener('click', async () => {
  const placa = document.getElementById('placa-achada').value.trim().toUpperCase();
  const local = document.getElementById('local-achado').value.trim();
  const data = document.getElementById('data-achado').value;
  const contato = document.getElementById('contato-achado').value;
  const result = document.getElementById('achei-placa-result');
  
  if (!placa || !local || !data || !contato) {
    result.textContent = 'Preencha todos os campos obrigat√≥rios.';
    return;
  }

  try {
    // Verifica se a placa est√° cadastrada como perdida
    const q = query(collection(firestore, "lostPlates"), where("plate", "==", placa));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
      result.textContent = 'Esta placa n√£o est√° cadastrada como perdida.';
      return;
    }

    // Atualiza o status para encontrada
    const docRef = querySnapshot.docs[0].ref;
    const updateData = {
      status: 'encontrada',
      foundLocation: local,
      foundDate: data,
      contactMethod: contato,
      updatedAt: new Date()
    };

    // Se o usu√°rio estiver logado, registramos quem encontrou
    if (auth.currentUser) {
      updateData.foundBy = auth.currentUser.uid;
    }

    await updateDoc(docRef, updateData);
    
    result.textContent = 'Placa informada como encontrada com sucesso!';
    setTimeout(() => voltarPara('placas-screen'), 1500);
  } catch (error) {
    result.textContent = 'Erro ao informar placa encontrada. Tente novamente.';
  }
});

// Monitorar estado de autentica√ß√£o
onAuthStateChanged(auth, async (user) => {
  if (user) {
    // Atualiza perfil
    const userQuery = query(collection(firestore, "users"), where("uid", "==", user.uid));
    const userSnapshot = await getDocs(userQuery);
    
    if (!userSnapshot.empty) {
      const userData = userSnapshot.docs[0].data();
      document.getElementById('perfil-nome').textContent = userData.nome;
      document.getElementById('perfil-email').textContent = userData.email;
      document.getElementById('perfil-telefone').textContent = userData.telefone;
    }

    // Carrega placas do usu√°rio
    const placasQuery = query(collection(firestore, "lostPlates"), where("ownerId", "==", user.uid));
    const placasSnapshot = await getDocs(placasQuery);
    const listaPlacas = document.getElementById('lista-minhas-placas');
    
    listaPlacas.innerHTML = '';
    
    if (placasSnapshot.empty) {
      listaPlacas.innerHTML = '<p>Voc√™ n√£o possui placas cadastradas.</p>';
      return;
    }

    placasSnapshot.forEach(doc => {
      const data = doc.data();
      const placaItem = document.createElement('div');
      placaItem.className = 'placa-item';
      
      placaItem.innerHTML = `
        <h3>Placa: ${data.plate}</h3>
        <p><strong>Status:</strong> ${data.status === 'encontrada' ? 'ENCONTRADA üéâ' : 'N√ÉO ENCONTRADA'}</p>
        <p><strong>Local:</strong> ${data.location || 'N√£o informado'}</p>
        ${data.status === 'encontrada' ? `<p><strong>Encontrada em:</strong> ${data.foundLocation}</p>` : ''}
      `;
      
      listaPlacas.appendChild(placaItem);
    });
  }
});
</script>
</body>
</html>
