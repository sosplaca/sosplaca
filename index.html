<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOS PLACA</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
    body { background-color: #f5f5f5; color: #333; line-height: 1.6; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    header { background-color: #2c3e50; color: white; padding: 20px; text-align: center; border-radius: 0 0 10px 10px; }
    .logo { font-size: 2.5rem; font-weight: bold; }
    h1 { font-size: 1.5rem; }
    .screen { background-color: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; display: none; }
    .screen.active { display: block; }
    .btn { display: inline-block; background-color: #3498db; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 500; margin: 10px 5px; }
    .btn:hover { background-color: #2980b9; }
    .btn-success { background-color: #27ae60; }
    .btn-success:hover { background-color: #219653; }
    .btn-secondary { background-color: #95a5a6; }
    .btn-secondary:hover { background-color: #7f8c8d; }
    .btn-danger { background-color: #e74c3c; }
    .btn-danger:hover { background-color: #c0392b; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 500; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; }
    .placa-type-container { display: flex; align-items: center; gap: 10px; }
    .placa-type-image { width: 80px; }
    .result { margin-top: 20px; padding: 15px; border-radius: 5px; background-color: #f8f9fa; display: none; }
    .result.success { display: block; border-left: 4px solid #27ae60; }
    .result.error { display: block; border-left: 4px solid #e74c3c; }
    footer { text-align: center; padding: 20px; background-color: #ecf0f1; margin-top: 30px; }
    @media (max-width:600px) {
      .container { padding: 10px; }
      .screen { padding: 15px; }
      .btn { padding: 10px 15px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="logo">SOS PLACA</div>
    <h1>Ajude a reunir placas perdidas com seus donos</h1>
    <a href="https://play.google.com/store/apps/details?id=fabricioramosdasilva.sos_placa" target="_blank" class="btn btn-success">üì≤ Baixe o App</a>
  </div>
</header>

<div class="container">

  <!-- Tela inicial -->
  <div id="home-screen" class="screen active">
    <h2>O que voc√™ deseja fazer?</h2>
    <p>Escolha uma op√ß√£o:</p>
    <div>
      <button id="perdi-btn" class="btn">Perdi uma placa</button>
      <button id="achei-btn" class="btn btn-success">Achei uma placa</button>
    </div>
  </div>

  <!-- Tela Perdi -->
  <div id="perdi-screen" class="screen">
    <h2>Buscar placa perdida</h2>
    <div class="form-group">
      <label>Tipo de placa:</label>
      <div class="placa-type-container">
        <input type="radio" id="perdi-tipo-comum" name="perdi-tipo-placa" value="comum" checked>
        <label for="perdi-tipo-comum"><img src="comum.png" class="placa-type-image">Padr√£o antigo (ABC-1234)</label>
      </div>
      <div class="placa-type-container">
        <input type="radio" id="perdi-tipo-mercosul" name="perdi-tipo-placa" value="mercosul">
        <label for="perdi-tipo-mercosul"><img src="mercosul.png" class="placa-type-image">Mercosul (ABC1D23)</label>
      </div>
    </div>
    <div class="form-group">
      <label for="perdi-placa">N√∫mero da placa:</label>
      <input type="text" id="perdi-placa" class="placa-input" placeholder="Digite a placa">
    </div>
    <div class="form-group" id="perdi-localizacao" style="display:none;">
      <label for="perdi-uf">UF:</label>
      <select id="perdi-uf"></select>
      <label for="perdi-municipio">Munic√≠pio:</label>
      <select id="perdi-municipio"></select>
    </div>
    <div>
      <button id="perdi-voltar" class="btn btn-secondary">Voltar</button>
      <button id="perdi-buscar" class="btn">Buscar Placa</button>
    </div>
    <div id="perdi-result" class="result">
      <p id="perdi-result-text"></p>
      <div id="perdi-result-contatos"></div>
      <button id="perdi-remover-btn" class="btn btn-danger" style="display:none;">Remover placa</button>
    </div>
  </div>
  <!-- Tela Achei -->
  <div id="achei-screen" class="screen">
    <h2>Cadastrar placa encontrada</h2>
    <div class="form-group">
      <label>Tipo de placa:</label>
      <div class="placa-type-container">
        <input type="radio" id="achei-tipo-comum" name="achei-tipo-placa" value="comum" checked>
        <label for="achei-tipo-comum"><img src="comum.png" class="placa-type-image">Padr√£o antigo (ABC-1234)</label>
      </div>
      <div class="placa-type-container">
        <input type="radio" id="achei-tipo-mercosul" name="achei-tipo-placa" value="mercosul">
        <label for="achei-tipo-mercosul"><img src="mercosul.png" class="placa-type-image">Mercosul (ABC1D23)</label>
      </div>
    </div>
    <div class="form-group">
      <label for="achei-placa">N√∫mero da placa:</label>
      <input type="text" id="achei-placa" class="placa-input" placeholder="Digite a placa">
    </div>
    <div class="form-group" id="achei-localizacao" style="display:none;">
      <label for="achei-uf">UF:</label>
      <select id="achei-uf"></select>
      <label for="achei-municipio">Munic√≠pio:</label>
      <select id="achei-municipio"></select>
    </div>
    <div class="form-group">
      <label for="achei-nome">Seu nome:</label>
      <input type="text" id="achei-nome" placeholder="Digite seu nome completo">
    </div>
    <div class="form-group">
      <label for="achei-telefone">Seu telefone:</label>
      <input type="tel" id="achei-telefone" placeholder="(00) 00000-0000">
    </div>
    <div>
      <button id="achei-voltar" class="btn btn-secondary">Voltar</button>
      <button id="achei-salvar" class="btn btn-success">Salvar Placa</button>
    </div>
    <div id="achei-result" class="result">
      <p id="achei-result-text"></p>
    </div>
  </div>

  <!-- Tela Cadastro para ser avisado -->
  <div id="aviso-screen" class="screen">
    <h2>Quer ser avisado?</h2>
    <p>N√£o encontramos sua placa no momento. Preencha seus dados para ser avisado por e-mail caso algu√©m a cadastre como encontrada.</p>
    <div class="form-group">
      <label for="aviso-nome">Seu nome:</label>
      <input type="text" id="aviso-nome" placeholder="Digite seu nome completo">
    </div>
    <div class="form-group">
      <label for="aviso-email">Seu e-mail:</label>
      <input type="email" id="aviso-email" placeholder="email@exemplo.com">
    </div>
    <div class="form-group">
      <label for="aviso-placa">Placa:</label>
      <input type="text" id="aviso-placa" readonly>
    </div>
    <div>
      <button id="aviso-voltar" class="btn btn-secondary">Voltar</button>
      <button id="aviso-salvar" class="btn btn-success">Quero ser avisado</button>
    </div>
    <div id="aviso-result" class="result">
      <p id="aviso-result-text"></p>
    </div>
  </div>

<footer>
  <div class="container">
    <p>SOS PLACA &copy; 2025 - Todos os direitos reservados.</p>
  </div>
</footer>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, set, get, remove, push } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBjetihGmlo_z01jx-GW9Ith0oDCS0jwYc",
    authDomain: "sosplaca-73cf7.firebaseapp.com",
    databaseURL: "https://sosplaca-73cf7-default-rtdb.firebaseio.com",
    projectId: "sosplaca-73cf7",
    storageBucket: "sosplaca-73cf7.appspot.com",
    messagingSenderId: "658059385722",
    appId: "1:658059385722:web:5ed0e8fd7f7a2931d894c3"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const firestore = getFirestore(app);

  // ===================== Dados de UF e Munic√≠pios =====================
  const estadosECidades = {
    "SP": ["Adamantina", "Adolfo", "Agua√≠", "√Åguas da Prata", "√Åguas de Lind√≥ia", "√Åguas de Santa B√°rbara", "√Åguas de S√£o Pedro", "Agudos", "Alambari", "Alfredo Marcondes", "Altair", "Altin√≥polis", "Alto Alegre", "Alum√≠nio", "√Ålvares Florence", "√Ålvares Machado", "√Ålvaro de Carvalho", "Alvinl√¢ndia", "Americana", "Am√©rico Brasiliense", "Am√©rico de Campos", "Amparo", "Anal√¢ndia", "Andradina", "Angatuba", "Anhembi", "Anhumas", "Aparecida", "Aparecida d'Oeste", "Apia√≠", "Ara√ßariguama", "Ara√ßatuba", "Ara√ßoiaba da Serra", "Aramina", "Arandu", "Arape√≠", "Araraquara", "Araras", "Arco-√çris", "Arealva", "Areias", "Arei√≥polis", "Ariranha", "Artur Nogueira", "Aruj√°", "Asp√°sia", "Assis", "Atibaia", "Auriflama", "Ava√≠", "Avanhandava", "Avar√©", "Bady Bassitt", "Balbinos", "B√°lsamo", "Bananal", "Bar√£o de Antonina", "Barbosa", "Bariri", "Barra Bonita", "Barra do Chap√©u", "Barra do Turvo", "Barretos", "Barrinha", "Barueri", "Bastos", "Batatais", "Bauru", "Bebedouro", "Bento de Abreu", "Bernardino de Campos", "Bertioga", "Bilac", "Birigui", "Biritiba Mirim", "Boa Esperan√ßa do Sul", "Bocaina", "Bofete", "Boituva", "Bom Jesus dos Perd√µes", "Bom Sucesso de Itarar√©", "Bor√°", "Boraceia", "Borborema", "Borebi", "Botucatu", "Bragan√ßa Paulista", "Bra√∫na", "Brejo Alegre", "Brodowski", "Brotas", "Buri", "Buritama", "Buritizal", "Cabr√°lia Paulista", "Cabre√∫va", "Ca√ßapava", "Cachoeira Paulista", "Caconde", "Cafel√¢ndia", "Caiabu", "Caieiras", "Caiu√°", "Cajamar", "Cajati", "Cajobi", "Cajuru", "Campina do Monte Alegre", "Campinas", "Campo Limpo Paulista", "Campos do Jord√£o", "Campos Novos Paulista", "Canan√©ia", "Canas", "C√¢ndido Mota", "C√¢ndido Rodrigues", "Canitar", "Cap√£o Bonito", "Capela do Alto", "Capivari", "Caraguatatuba", "Carapicu√≠ba", "Cardoso", "Casa Branca", "C√°ssia dos Coqueiros", "Castilho", "Catanduva", "Catigu√°", "Cedral", "Cerqueira C√©sar", "Cerquilho", "Ces√°rio Lange", "Charqueada", "Chavantes", "Clementina", "Colina", "Col√¥mbia", "Conchal", "Conchas", "Cordeir√≥polis", "Coroados", "Coronel Macedo", "Corumbata√≠", "Cosm√≥polis", "Cosmorama", "Cotia", "Cravinhos", "Cristais Paulista", "Cruz√°lia", "Cruzeiro", "Cubat√£o", "Cunha", "Descalvado", "Diadema", "Dirce Reis", "Divinol√¢ndia", "Dobrada", "Dois C√≥rregos", "Dolcin√≥polis", "Dourado", "Dracena", "Duartina", "Dumont", "Echapor√£", "Eldorado", "Elias Fausto", "Elisi√°rio", "Emba√∫ba", "Embu das Artes", "Embu-Gua√ßu", "Emilian√≥polis", "Engenheiro Coelho", "Esp√≠rito Santo do Pinhal", "Esp√≠rito Santo do Turvo", "Estiva Gerbi", "Estrela do Norte", "Estrela d'Oeste", "Euclides da Cunha Paulista", "Fartura", "Fernando Prestes", "Fernand√≥polis", "Fern√£o", "Ferraz de Vasconcelos", "Flora Rica", "Floreal", "Fl√≥rida Paulista", "Flor√≠nea", "Franca", "Francisco Morato", "Franco da Rocha", "Gabriel Monteiro", "G√°lia", "Gar√ßa", "Gast√£o Vidigal", "Gavi√£o Peixoto", "General Salgado", "Getulina", "Glic√©rio", "Guai√ßara", "Guaimb√™", "Gua√≠ra", "Guapia√ßu", "Guapiara", "Guar√°", "Guara√ßa√≠", "Guaraci", "Guarani d'Oeste", "Guarant√£", "Guararapes", "Guararema", "Guaratinguet√°", "Guare√≠", "Guariba", "Guaruj√°", "Guarulhos", "Guzol√¢ndia", "Hercul√¢ndia", "Holambra", "Hortol√¢ndia", "Iacanga", "Iacri", "Iaras", "Ibat√©", "Ibir√°", "Ibirarema", "Ibitinga", "Ibi√∫na", "Ic√©m", "Iep√™", "Igara√ßu do Tiet√™", "Igarapava", "Igarat√°", "Iguape", "Ilha Comprida", "Ilha Solteira", "Ilhabela", "Indaiatuba", "Indiana", "Indiapor√£", "In√∫bia Paulista", "Ipaussu", "Iper√≥", "Ipe√∫na", "Ipigu√°", "Iporanga", "Ipu√£", "Iracem√°polis", "Irapu√£", "Irapuru", "Itaber√°", "Ita√≠", "Itajobi", "Itaju", "Itanha√©m", "Itaoca", "Itapecerica da Serra", "Itapetininga", "Itapeva", "Itapevi", "Itapira", "Itapirapu√£ Paulista", "It√°polis", "Itaporanga", "Itapu√≠", "Itapura", "Itaquaquecetuba", "Itarar√©", "Itariri", "Itatiba", "Itatinga", "Itirapina", "Itirapu√£", "Itobi", "Itu", "Itupeva", "Ituverava", "Jaborandi", "Jaboticabal", "Jaci", "Jacupiranga", "Jaguari√∫na", "Jales", "Jambeiro", "Jandira", "Jardin√≥polis", "Jarinu", "Ja√∫", "Jeriquara", "Joan√≥polis", "Jo√£o Ramalho", "Jos√© Bonif√°cio", "J√∫lio Mesquita", "Jumirim", "Jundia√≠", "Junqueir√≥polis", "Juqui√°", "Juquitiba", "Lagoinha", "Laranjal Paulista", "Lav√≠nia", "Lavrinhas", "Leme", "Len√ß√≥is Paulista", "Limeira", "Lindoia", "Lins", "Lorena", "Lourdes", "Louveira", "Luc√©lia", "Lucian√≥polis", "Luiz Ant√¥nio", "Luizi√¢nia", "Lup√©rcio", "Lut√©cia", "Macatuba", "Macaubal", "Maced√¥nia", "Magda", "Mairinque", "Mairipor√£", "Manduri", "Marab√° Paulista", "Maraca√≠", "Marapoama", "Mari√°polis", "Mar√≠lia", "Marin√≥polis", "Martin√≥polis", "Mat√£o", "Mau√°", "Mendon√ßa", "Meridiano", "Mes√≥polis", "Miguel√≥polis", "Mineiros do Tiet√™", "Mira Estrela", "Miracatu", "Mirand√≥polis", "Mirante do Paranapanema", "Mirassol", "Mirassol√¢ndia", "Mococa", "Mogi das Cruzes", "Mogi Gua√ßu", "Mogi Mirim", "Mombuca", "Mon√ß√µes", "Mongagu√°", "Monte Alegre do Sul", "Monte Alto", "Monte Apraz√≠vel", "Monte Azul Paulista", "Monte Castelo", "Monte Mor", "Monteiro Lobato", "Morro Agudo", "Morungaba", "Motuca", "Murutinga do Sul", "Nantes", "Narandiba", "Natividade da Serra", "Nazar√© Paulista", "Neves Paulista", "Nhandeara", "Nipo√£", "Nova Alian√ßa", "Nova Campina", "Nova Cana√£ Paulista", "Nova Castilho", "Nova Europa", "Nova Granada", "Nova Guataporanga", "Nova Independ√™ncia", "Nova Luzit√¢nia", "Nova Odessa", "Novais", "Novo Horizonte", "Nuporanga", "Ocau√ßu", "√ìleo", "Ol√≠mpia", "Onda Verde", "Oriente", "Orindi√∫va", "Orl√¢ndia", "Osasco", "Oscar Bressane", "Osvaldo Cruz", "Ourinhos", "Ouro Verde", "Ouroeste", "Pacaembu", "Palestina", "Palmares Paulista", "Palmeira d'Oeste", "Palmital", "Panorama", "Paragua√ßu Paulista", "Paraibuna", "Para√≠so", "Paranapanema", "Paranapu√£", "Parapu√£", "Pardinho", "Pariquera-A√ßu", "Parisi", "Patroc√≠nio Paulista", "Paulic√©ia", "Paul√≠nia", "Paulist√¢nia", "Paulo de Faria", "Pederneiras", "Pedra Bela", "Pedran√≥polis", "Pedregulho", "Pedreira", "Pedrinhas Paulista", "Pedro de Toledo", "Pen√°polis", "Pereira Barreto", "Pereiras", "Peru√≠be", "Piacatu", "Piedade", "Pilar do Sul", "Pindamonhangaba", "Pindorama", "Pinhalzinho", "Piquerobi", "Piquete", "Piracaia", "Piracicaba", "Piraju", "Piraju√≠", "Pirangi", "Pirapora do Bom Jesus", "Pirapozinho", "Pirassununga", "Piratininga", "Pitangueiras", "Planalto", "Platina", "Po√°", "Poloni", "Pompeia", "Ponga√≠", "Pontal", "Pontalinda", "Pontes Gestal", "Populina", "Porangaba", "Porto Feliz", "Porto Ferreira", "Potim", "Potirendaba", "Pracinha", "Prad√≥polis", "Praia Grande", "Prat√¢nia", "Presidente Alves", "Presidente Bernardes", "Presidente Epit√°cio", "Presidente Prudente", "Presidente Venceslau", "Promiss√£o", "Quadra", "Quat√°", "Queiroz", "Queluz", "Quintana", "Rafard", "Rancharia", "Reden√ß√£o da Serra", "Regente Feij√≥", "Regin√≥polis", "Registro", "Restinga", "Ribeira", "Ribeir√£o Bonito", "Ribeir√£o Branco", "Ribeir√£o Corrente", "Ribeir√£o do Sul", "Ribeir√£o dos √çndios", "Ribeir√£o Grande", "Ribeir√£o Pires", "Ribeir√£o Preto", "Rifaina", "Rinc√£o", "Rin√≥polis", "Rio Claro", "Rio das Pedras", "Rio Grande da Serra", "Riol√¢ndia", "Riversul", "Rosana", "Roseira", "Rubi√°cea", "Rubin√©ia", "Sabino", "Sagres", "Sales", "Sales Oliveira", "Sales√≥polis", "Salmour√£o", "Saltinho", "Salto", "Salto de Pirapora", "Salto Grande", "Sandovalina", "Santa Ad√©lia", "Santa Albertina", "Santa B√°rbara d'Oeste", "Santa Branca", "Santa Clara d'Oeste", "Santa Cruz da Concei√ß√£o", "Santa Cruz da Esperan√ßa", "Santa Cruz das Palmeiras", "Santa Cruz do Rio Pardo", "Santa Ernestina", "Santa F√© do Sul", "Santa Gertrudes", "Santa Isabel", "Santa L√∫cia", "Santa Maria da Serra", "Santa Mercedes", "Santa Rita do Passa Quatro", "Santa Rita d'Oeste", "Santa Rosa de Viterbo", "Santa Salete", "Santana da Ponte Pensa", "Santana de Parna√≠ba", "Santo Anast√°cio", "Santo Andr√©", "Santo Ant√¥nio da Alegria", "Santo Ant√¥nio de Posse", "Santo Ant√¥nio do Aracangu√°", "Santo Ant√¥nio do Jardim", "Santo Ant√¥nio do Pinhal", "Santo Expedito", "Sant√≥polis do Aguape√≠", "Santos", "S√£o Bento do Sapuca√≠", "S√£o Bernardo do Campo", "S√£o Caetano do Sul", "S√£o Carlos", "S√£o Francisco", "S√£o Jo√£o da Boa Vista", "S√£o Jo√£o das Duas Pontes", "S√£o Jo√£o de Iracema", "S√£o Jo√£o do Pau-d'Alho", "S√£o Joaquim da Barra", "S√£o Jos√© da Bela Vista", "S√£o Jos√© do Barreiro", "S√£o Jos√© do Rio Pardo", "S√£o Jos√© do Rio Preto", "S√£o Jos√© dos Campos", "S√£o Louren√ßo da Serra", "S√£o Luiz do Paraitinga", "S√£o Manuel", "S√£o Miguel Arcanjo", "S√£o Paulo", "S√£o Pedro", "S√£o Pedro do Turvo", "S√£o Roque", "S√£o Sebasti√£o", "S√£o Sebasti√£o da Grama", "S√£o Sim√£o", "S√£o Vicente", "Sarapu√≠", "Sarutai√°", "Sebastian√≥polis do Sul", "Serra Azul", "Serra Negra", "Serrana", "Sert√£ozinho", "Sete Barras", "Sever√≠nia", "Silveiras", "Socorro", "Sorocaba", "Sud Mennucci", "Sumar√©", "Suzan√°polis", "Suzano", "Tabapu√£", "Tabatinga", "Tabo√£o da Serra", "Taciba", "Tagua√≠", "Taia√ßu", "Tai√∫va", "Tamba√∫", "Tanabi", "Tapira√≠", "Tapiratiba", "Taquaral", "Taquaritinga", "Taquarituba", "Taquariva√≠", "Tarabai", "Tarum√£", "Tatu√≠", "Taubat√©", "Tejup√°", "Teodoro Sampaio", "Terra Roxa", "Tiet√™", "Timburi", "Torre de Pedra", "Torrinha", "Trabiju", "Trememb√©", "Tr√™s Fronteiras", "Tuiuti", "Tup√£", "Tupi Paulista", "Turi√∫ba", "Turmalina", "Ubarana", "Ubatuba", "Ubirajara", "Uchoa", "Uni√£o Paulista", "Ur√¢nia", "Uru", "Urup√™s", "Valentim Gentil", "Valinhos", "Valpara√≠so", "Vargem", "Vargem Grande do Sul", "Vargem Grande Paulista", "V√°rzea Paulista", "Vera Cruz", "Vinhedo", "Viradouro", "Vista Alegre do Alto", "Vit√≥ria Brasil", "Votorantim", "Votuporanga", "Zacarias"],
    "RJ": ["Rio de Janeiro", "Niter√≥i", "Petr√≥polis"],
    "MG": ["Belo Horizonte", "Uberl√¢ndia", "Juiz de Fora"],
    "BA": ["Salvador", "Feira de Santana", "Ilh√©us"],
    "PR": ["Curitiba", "Londrina", "Maring√°"],
    "RS": ["Porto Alegre", "Caxias do Sul", "Pelotas"],
    "SC": ["Florian√≥polis", "Joinville", "Blumenau"]
    // üî• Adicione mais estados e munic√≠pios conforme quiser.
  };

  const ufElements = [
    { uf: document.getElementById('perdi-uf'), municipio: document.getElementById('perdi-municipio') },
    { uf: document.getElementById('achei-uf'), municipio: document.getElementById('achei-municipio') }
  ];

  ufElements.forEach(({ uf, municipio }) => {
    uf.innerHTML = `<option value=''>Selecione o Estado</option>`;
    for (const estado in estadosECidades) {
      uf.innerHTML += `<option value='${estado}'>${estado}</option>`;
    }
    uf.addEventListener('change', () => {
      municipio.innerHTML = `<option value=''>Selecione o Munic√≠pio</option>`;
      const cidades = estadosECidades[uf.value] || [];
      cidades.forEach(cidade => {
        municipio.innerHTML += `<option value='${cidade}'>${cidade}</option>`;
      });
    });
  });

  // ===================== Manipula√ß√£o de telas =====================
  const homeScreen = document.getElementById('home-screen');
  const perdiScreen = document.getElementById('perdi-screen');
  const acheiScreen = document.getElementById('achei-screen');
  const avisoScreen = document.getElementById('aviso-screen');

  document.getElementById('perdi-btn').onclick = () => switchScreen(homeScreen, perdiScreen);
  document.getElementById('achei-btn').onclick = () => switchScreen(homeScreen, acheiScreen);
  document.getElementById('perdi-voltar').onclick = () => switchScreen(perdiScreen, homeScreen);
  document.getElementById('achei-voltar').onclick = () => switchScreen(acheiScreen, homeScreen);
  document.getElementById('aviso-voltar').onclick = () => switchScreen(avisoScreen, homeScreen);

  function switchScreen(hide, show) {
    hide.classList.remove('active');
    show.classList.add('active');
  }

  // ===================== Cadastro para receber aviso =====================
  const avisoNome = document.getElementById('aviso-nome');
  const avisoEmail = document.getElementById('aviso-email');
  const avisoPlaca = document.getElementById('aviso-placa');
  const avisoSalvar = document.getElementById('aviso-salvar');
  const avisoResult = document.getElementById('aviso-result');
  const avisoResultText = document.getElementById('aviso-result-text');

  avisoSalvar.onclick = async () => {
    const nome = avisoNome.value.trim();
    const email = avisoEmail.value.trim();
    const placa = avisoPlaca.value.trim();

    if (!nome || !email) {
      avisoResult.className = 'result error';
      avisoResultText.innerText = 'Preencha seu nome e e-mail.';
      return;
    }

    const userRef = doc(firestore, "users", email);
    const userSnap = await getDoc(userRef);

    if (userSnap.exists()) {
      await updateDoc(userRef, {
        placas: arrayUnion(placa),
        dataCadastro: new Date().toISOString()
      });
      avisoResult.className = 'result success';
      avisoResultText.innerText = 'Cadastro atualizado! Voc√™ ser√° avisado.';
    } else {
      await setDoc(userRef, {
        nome: nome,
        email: email,
        placas: [placa],
        dataCadastro: new Date().toISOString()
      });
      avisoResult.className = 'result success';
      avisoResultText.innerText = 'Cadastro realizado! Voc√™ ser√° avisado.';
    }
  };
</script>
<script type="module">
  // ===================== Valida√ß√£o de placa =====================
  function validarPlaca(placa, tipo) {
    if (tipo === 'comum') {
      const regex = /^[A-Z]{3}-?\d{4}$/;
      return regex.test(placa);
    } else {
      const regex = /^[A-Z]{3}\d[A-Z]\d{2}$/;
      return regex.test(placa);
    }
  }

  function formatarPlaca(placa) {
    return placa.replace('-', '').toUpperCase();
  }

  function validarLocalizacao(tipo, uf, municipio) {
    if (tipo === 'comum' && (!uf || !municipio)) {
      return false;
    }
    return true;
  }

  // ===================== Buscar placa perdida =====================
  document.getElementById('perdi-buscar').onclick = async () => {
    const tipo = document.getElementById('perdi-tipo-comum').checked ? 'comum' : 'mercosul';
    const placa = formatarPlaca(document.getElementById('perdi-placa').value.trim());
    const uf = document.getElementById('perdi-uf').value;
    const municipio = document.getElementById('perdi-municipio').value;

    if (!validarPlaca(placa, tipo)) {
      alert('Placa inv√°lida!');
      return;
    }

    if (!validarLocalizacao(tipo, uf, municipio)) {
      alert('Informe UF e Munic√≠pio para placas comuns.');
      return;
    }

    const path = tipo === 'comum' ? `${uf}_${municipio}_${placa}` : placa;
    const dbRef = ref(database, 'placas/' + path);
    const snapshot = await get(dbRef);

    if (snapshot.exists()) {
      const dados = snapshot.val();
      alert(`Placa encontrada! Contato: ${dados.nome} - ${dados.telefone}`);
    } else {
      if (confirm('Placa n√£o encontrada. Deseja ser avisado quando ela for cadastrada?')) {
        avisoPlaca.value = placa;
        switchScreen(perdiScreen, avisoScreen);
      } else {
        alert('Continue procurando!');
      }
    }
  };

  // ===================== Cadastrar placa encontrada =====================
  document.getElementById('achei-salvar').onclick = async () => {
    const tipo = document.getElementById('achei-tipo-comum').checked ? 'comum' : 'mercosul';
    const placa = formatarPlaca(document.getElementById('achei-placa').value.trim());
    const nome = document.getElementById('achei-nome').value.trim();
    const telefone = document.getElementById('achei-telefone').value.trim();
    const uf = document.getElementById('achei-uf').value;
    const municipio = document.getElementById('achei-municipio').value;

    if (!validarPlaca(placa, tipo)) {
      alert('Placa inv√°lida!');
      return;
    }

    if (!nome || nome.length < 3) {
      alert('Digite seu nome.');
      return;
    }

    if (!telefone || telefone.replace(/\D/g, '').length < 11) {
      alert('Telefone inv√°lido.');
      return;
    }

    if (!validarLocalizacao(tipo, uf, municipio)) {
      alert('Informe UF e Munic√≠pio para placas comuns.');
      return;
    }

    const path = tipo === 'comum' ? `${uf}_${municipio}_${placa}` : placa;
    const dados = {
      nome,
      telefone,
      tipo,
      uf: tipo === 'comum' ? uf : '',
      municipio: tipo === 'comum' ? municipio : '',
      timestamp: Date.now()
    };

    await set(ref(database, 'placas/' + path), dados);
    alert('Placa cadastrada com sucesso!');

    // üî• Aqui voc√™ poder√° configurar a integra√ß√£o com Firebase Extensions ‚Üí Trigger Email
    // para verificar no Firestore quem est√° aguardando essa placa e disparar o e-mail automaticamente.
  };

  // ===================== Controle dos campos de localiza√ß√£o (UF e Munic√≠pio) =====================
  const perdiTipoComum = document.getElementById('perdi-tipo-comum');
  const acheiTipoComum = document.getElementById('achei-tipo-comum');
  const perdiLocalizacao = document.getElementById('perdi-localizacao');
  const acheiLocalizacao = document.getElementById('achei-localizacao');

  function atualizarLocalizacaoPerdi() {
    perdiLocalizacao.style.display = perdiTipoComum.checked ? 'block' : 'none';
  }

  function atualizarLocalizacaoAchei() {
    acheiLocalizacao.style.display = acheiTipoComum.checked ? 'block' : 'none';
  }

  perdiTipoComum.addEventListener('change', atualizarLocalizacaoPerdi);
  acheiTipoComum.addEventListener('change', atualizarLocalizacaoAchei);

  atualizarLocalizacaoPerdi();
  atualizarLocalizacaoAchei();
</script>
