<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SOS PLACA</title>
  <link rel="icon" type="image/png" href="logo.png"/>

  <!-- Fontes personalizadas -->
  <style>
    @font-face {
      font-family: 'JostBold';
      src: url('jostbold.ttf') format('truetype');
    }
    @font-face {
      font-family: 'JostMedium';
      src: url('jostmedium.ttf') format('truetype');
    }
    @font-face {
      font-family: 'JostRegular';
      src: url('jostregular.ttf') format('truetype');
    }
    @font-face {
      font-family: 'UrbanistBold';
      src: url('urbanistbold.ttf') format('truetype');
    }
    @font-face {
      font-family: 'UrbanistRegular';
      src: url('urbanistregular.ttf') format('truetype');
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'JostRegular', sans-serif;
    }
    body {
      background-color: #FAFAFA;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      background-color: #0077B6;
      color: #fff;
      padding: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 0 0 10px 10px;
      cursor: pointer; /* Para indicar que é clicável */
    }
    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-img {
      width: 50px;
      height: 50px;
    }
    .logo-text {
      font-size: 2rem;
      font-family: 'JostBold';
    }
    h1 {
      font-size: 1.2rem;
      color: #fff;
    }
    .screen {
      background-color: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 1.25rem;
      display: none;
    }
    .screen.active {
      display: block;
    }
    .btn {
      display: inline-block;
      background-color: #023E8A;
      color: #fff;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.625rem 0.3125rem;
    }
    .btn-success {
      background-color: #F8961E;
    }
    .btn-secondary {
      background-color: #ADB5BD;
    }
    .btn-danger {
      background-color: #e74c3c;
    }
    .form-group {
      margin-bottom: 1.25rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    input,
    select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    .result {
      margin-top: 1.25rem;
      padding: 0.9375rem;
      border-radius: 6px;
      background-color: #f8f9fa;
      display: none;
      white-space: pre-line; /* Para respeitar quebras de linha */
    }
    .result.success {
      display: block;
      border-left: 6px solid #27ae60;
    }
    .result.error {
      display: block;
      border-left: 6px solid #e74c3c;
    }
    .alert-box {
      background-color: #fff8e1;
      border-left: 6px solid #f1c40f;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    footer {
      background-color: #023E8A;
      color: white;
      padding: 15px;
      text-align: center;
      border-radius: 10px 10px 0 0;
      margin-top: 30px;
    }
    .user-plates {
      margin-top: 20px;
    }
    .plate-card {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .profile-info {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        gap: 10px;
      }
      h1 {
        text-align: center;
      }
    }
  </style>
</head>

<body>

  <!-- Cabeçalho clicável (volta ao menu ao clicar) -->
  <header id="header-home">
    <div class="logo-container">
      <img src="logo.png" alt="Logo SOS Placa" class="logo-img">
      <div class="logo-text">SOS PLACA</div>
    </div>
    <h1>Se achou, avise! Se perdeu, procure aqui!</h1>
    <a href="https://play.google.com/store/apps/details?id=fabricioramosdasilva.sos_placa" target="_blank">
      <img src="GooglePlay.png" alt="Baixar na Google Play" style="height: 90px;">
    </a>
  </header>

  <div class="container">
    <!-- Menu Inicial -->
    <div id="menu-screen" class="screen active">
      <h2>O que você deseja fazer?</h2>
      <button id="btn-placas" class="btn">Buscar/Cadastrar Placas</button>
      <button id="btn-minhas-placas" class="btn">Minhas Placas</button>
      <button id="btn-perfil" class="btn">Meu Perfil</button>
    </div>

    <!-- Tela Buscar/Cadastrar Placas -->
    <div id="placas-screen" class="screen">
      <h2>Buscar/Cadastrar Placas</h2>
      <button id="btn-perdi" class="btn">Perdi uma placa</button>
      <button id="btn-achei" class="btn">Achei uma placa</button>
      <button id="btn-voltar-placas" class="btn btn-secondary">Voltar</button>
    </div>

    <!-- Tela Minhas Placas -->
    <div id="minhas-placas-screen" class="screen">
      <h2>Minhas Placas Perdidas</h2>
      <div id="minhas-placas-content">
        <!-- Se não estiver logado, aparecerá mensagem + botão “Entrar” -->
      </div>
      <button id="btn-voltar-minhas" class="btn btn-secondary">Voltar</button>
    </div>

    <!-- Tela Perfil -->
    <div id="perfil-screen" class="screen">
      <h2>Meu Perfil</h2>
      <div id="perfil-content">
        <!-- Se não estiver logado, aparecerá mensagem + botão “Entrar” -->
      </div>
      <button id="btn-voltar-perfil" class="btn btn-secondary">Voltar</button>
    </div>

    <!-- Tela Login -->
    <div id="login-screen" class="screen">
      <h2>Login</h2>
      <div class="form-group">
        <label for="login-email">E-mail:</label>
        <input type="email" id="login-email" placeholder="Digite seu e-mail" />
      </div>
      <div class="form-group">
        <label for="login-senha">Senha:</label>
        <input type="password" id="login-senha" placeholder="Digite sua senha" />
      </div>
      <button id="btn-login" class="btn btn-success">Entrar</button>
      <button id="btn-ir-cadastro" class="btn">Não tem conta? Cadastre-se</button>
      <button id="btn-voltar-login" class="btn btn-secondary">Voltar</button>
      <div id="login-result" class="result"></div>
    </div>

    <!-- Tela Cadastro -->
    <div id="cadastro-screen" class="screen">
      <h2>Cadastro</h2>
      <div class="form-group">
        <label for="cadastro-nome">Nome Completo:</label>
        <input type="text" id="cadastro-nome" placeholder="Digite seu nome completo" />
      </div>
      <div class="form-group">
        <label for="cadastro-email">E-mail:</label>
        <input type="email" id="cadastro-email" placeholder="Digite seu e-mail" />
      </div>
      <div class="form-group">
        <label for="cadastro-telefone">Telefone:</label>
        <input type="tel" id="cadastro-telefone" placeholder="(00) 00000-0000" />
      </div>
      <div class="form-group">
        <label for="cadastro-senha">Senha:</label>
        <input type="password" id="cadastro-senha" placeholder="Digite sua senha" />
      </div>
      <div class="form-group">
        <label for="cadastro-confirmar-senha">Confirmar Senha:</label>
        <input type="password" id="cadastro-confirmar-senha" placeholder="Confirme sua senha" />
      </div>
      <button id="btn-cadastrar" class="btn btn-success">Cadastrar</button>
      <button id="btn-voltar-cadastro" class="btn btn-secondary">Voltar</button>
      <div id="cadastro-result" class="result"></div>
    </div>

    <!-- Tela Perdi uma Placa -->
    <div id="perdi-screen" class="screen">
      <h2>Perdi uma Placa</h2>
      <div class="form-group">
        <label for="perdi-tipo">Tipo de Placa:</label>
        <select id="perdi-tipo">
          <option value="comum">Comum</option>
          <option value="mercosul">Mercosul</option>
        </select>
      </div>
      <div class="form-group">
        <label for="perdi-placa">Número da Placa:</label>
        <input type="text" id="perdi-placa" placeholder="Ex: ABC1234 ou ABC1D23" />
      </div>
      <div class="form-group" id="perdi-localizacao-group">
        <label for="perdi-uf">Estado (UF):</label>
        <select id="perdi-uf">
          <option value="" disabled selected>Selecione o estado</option>
          <option value="AC">AC</option>
          <option value="AL">AL</option>
          <option value="AM">AM</option>
          <option value="AP">AP</option>
          <option value="BA">BA</option>
          <option value="CE">CE</option>
          <option value="DF">DF</option>
          <option value="ES">ES</option>
          <option value="GO">GO</option>
          <option value="MA">MA</option>
          <option value="MG">MG</option>
          <option value="MS">MS</option>
          <option value="MT">MT</option>
          <option value="PA">PA</option>
          <option value="PB">PB</option>
          <option value="PE">PE</option>
          <option value="PI">PI</option>
          <option value="PR">PR</option>
          <option value="RJ">RJ</option>
          <option value="RN">RN</option>
          <option value="RO">RO</option>
          <option value="RR">RR</option>
          <option value="RS">RS</option>
          <option value="SC">SC</option>
          <option value="SE">SE</option>
          <option value="SP">SP</option>
          <option value="TO">TO</option>
        </select>
        <label for="perdi-municipio">Município:</label>
        <select id="perdi-municipio">
          <option value="" disabled selected>Selecione o município</option>
        </select>
      </div>
      <button id="perdi-verificar" class="btn btn-success">Verificar Placa</button>
      <button id="perdi-salvar" class="btn btn-success">Salvar Placa Perdida</button>
      <button id="btn-voltar-perdi" class="btn btn-secondary">Voltar</button>
      <div id="perdi-result" class="result"></div>
    </div>

    <!-- Tela Achei uma Placa -->
    <div id="achei-screen" class="screen">
      <h2>Achei uma Placa</h2>
      <div class="form-group">
        <label for="achei-tipo">Tipo de Placa:</label>
        <select id="achei-tipo">
          <option value="comum">Comum</option>
          <option value="mercosul">Mercosul</option>
        </select>
      </div>
      <div class="form-group">
        <label for="achei-placa">Número da Placa:</label>
        <input type="text" id="achei-placa" placeholder="Ex: ABC1234 ou ABC1D23" />
      </div>
      <div class="form-group" id="achei-localizacao-group">
        <label for="achei-uf">Estado (UF):</label>
        <select id="achei-uf">
          <option value="" disabled selected>Selecione o estado</option>
          <option value="AC">AC</option>
          <option value="AL">AL</option>
          <option value="AM">AM</option>
          <option value="AP">AP</option>
          <option value="BA">BA</option>
          <option value="CE">CE</option>
          <option value="DF">DF</option>
          <option value="ES">ES</option>
          <option value="GO">GO</option>
          <option value="MA">MA</option>
          <option value="MG">MG</option>
          <option value="MS">MS</option>
          <option value="MT">MT</option>
          <option value="PA">PA</option>
          <option value="PB">PB</option>
          <option value="PE">PE</option>
          <option value="PI">PI</option>
          <option value="PR">PR</option>
          <option value="RJ">RJ</option>
          <option value="RN">RN</option>
          <option value="RO">RO</option>
          <option value="RR">RR</option>
          <option value="RS">RS</option>
          <option value="SC">SC</option>
          <option value="SE">SE</option>
          <option value="SP">SP</option>
          <option value="TO">TO</option>
        </select>
        <label for="achei-municipio">Município:</label>
        <select id="achei-municipio">
          <option value="" disabled selected>Selecione o município</option>
        </select>
      </div>
      <div class="form-group">
        <label for="achei-nome">Seu nome:</label>
        <input type="text" id="achei-nome" placeholder="Digite seu nome" />
      </div>
      <div class="form-group">
        <label for="achei-telefone">Telefone para contato:</label>
        <input type="tel" id="achei-telefone" placeholder="(00) 00000-0000" />
      </div>
      <button id="achei-salvar" class="btn btn-success">Salvar Placa</button>
      <button id="btn-voltar-achei" class="btn btn-secondary">Voltar</button>
      <div id="achei-result" class="result"></div>
    </div>
  </div>

  <footer>
    💙 Ajude a manter esse projeto!<br>
    <strong>PIX:</strong> sosplaca.app@gmail.com
  </footer>
  <!-- Parte 2: Scripts JavaScript para comunicação com Firebase e lógica da página -->
  <script type="module">
    // ================================ IMPORTS FIREBASE (v9 modular) ================================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // ================================ CONFIGURAÇÃO DO FIREBASE ================================
    const firebaseConfig = {
      apiKey: 'AIzaSyBn6cCXLnU6LUH7kOjVtvpuceQ2lVzzczg',
      authDomain: 'sosplaca-73cf7.firebaseapp.com',
      projectId: 'sosplaca-73cf7',
      storageBucket: 'sosplaca-73cf7.appspot.com',
      messagingSenderId: '658059385722',
      appId: '1:658059385722:web:202e84abf6dcc6fbd894c3',
      databaseURL: 'https://sosplaca-73cf7-default-rtdb.firebaseio.com'
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ================================ ELEMENTOS (TELAS e BOTÕES) ================================
    // Telas
    const menuScreen = document.getElementById("menu-screen");
    const placasScreen = document.getElementById("placas-screen");
    const minhasPlacasScreen = document.getElementById("minhas-placas-screen");
    const perfilScreen = document.getElementById("perfil-screen");
    const loginScreen = document.getElementById("login-screen");
    const cadastroScreen = document.getElementById("cadastro-screen");
    const perdiScreen = document.getElementById("perdi-screen");
    const acheiScreen = document.getElementById("achei-screen");

    // Botões do menu
    const btnPlacas = document.getElementById("btn-placas");
    const btnMinhasPlacas = document.getElementById("btn-minhas-placas");
    const btnPerfil = document.getElementById("btn-perfil");

    // Botões "Perdi" e "Achei"
    const btnPerdi = document.getElementById("btn-perdi");
    const btnAchei = document.getElementById("btn-achei");

    // Botões "Voltar" (cada tela)
    const btnVoltarPlacas = document.getElementById("btn-voltar-placas");
    const btnVoltarMinhas = document.getElementById("btn-voltar-minhas");
    const btnVoltarPerfil = document.getElementById("btn-voltar-perfil");
    const btnVoltarLogin = document.getElementById("btn-voltar-login");
    const btnVoltarCadastro = document.getElementById("btn-voltar-cadastro");
    const btnVoltarPerdi = document.getElementById("btn-voltar-perdi");
    const btnVoltarAchei = document.getElementById("btn-voltar-achei");

    // Login/Cadastro
    const btnLogin = document.getElementById("btn-login");
    const btnIrCadastro = document.getElementById("btn-ir-cadastro");
    const btnCadastrar = document.getElementById("btn-cadastrar");

    // Elementos Tela Perdi
    const perdiTipo = document.getElementById("perdi-tipo");
    const perdiPlaca = document.getElementById("perdi-placa");
    const perdiUf = document.getElementById("perdi-uf");
    const perdiMunicipio = document.getElementById("perdi-municipio");
    const perdiVerificar = document.getElementById("perdi-verificar");
    const perdiSalvar = document.getElementById("perdi-salvar");
    const perdiResult = document.getElementById("perdi-result");
    const perdiLocalGroup = document.getElementById("perdi-localizacao-group");

    // Elementos Tela Achei
    const acheiTipo = document.getElementById("achei-tipo");
    const acheiPlaca = document.getElementById("achei-placa");
    const acheiUf = document.getElementById("achei-uf");
    const acheiMunicipio = document.getElementById("achei-municipio");
    const acheiNome = document.getElementById("achei-nome");
    const acheiTelefone = document.getElementById("achei-telefone");
    const acheiSalvar = document.getElementById("achei-salvar");
    const acheiResult = document.getElementById("achei-result");
    const acheiLocalGroup = document.getElementById("achei-localizacao-group");

    // Elementos Tela Minhas Placas
    const minhasPlacasContent = document.getElementById("minhas-placas-content");

    // Elementos Tela Perfil
    const perfilContent = document.getElementById("perfil-content");

    // Elementos Tela Login/Cadastro
    const loginEmail = document.getElementById("login-email");
    const loginSenha = document.getElementById("login-senha");
    const loginResult = document.getElementById("login-result");

    const cadastroNome = document.getElementById("cadastro-nome");
    const cadastroEmail = document.getElementById("cadastro-email");
    const cadastroTelefone = document.getElementById("cadastro-telefone");
    const cadastroSenha = document.getElementById("cadastro-senha");
    const cadastroConfirmar = document.getElementById("cadastro-confirmar-senha");
    const cadastroResult = document.getElementById("cadastro-result");

    // ================================ FUNÇÕES DE NAVEGAÇÃO DE TELAS ================================
    function showScreen(screen) {
      // Esconde todas as telas
      [
        menuScreen,
        placasScreen,
        minhasPlacasScreen,
        perfilScreen,
        loginScreen,
        cadastroScreen,
        perdiScreen,
        acheiScreen
      ].forEach((s) => s.classList.remove("active"));

      // Mostra apenas a tela informada
      screen.classList.add("active");
    }

    // Torna acessível globalmente (para que event listeners inline, se existirem, funcionem)
    window.voltarMenu = () => showScreen(menuScreen);

    // ================================ ASSOCIAÇÃO DE EVENTOS ================================
    // Ao carregar a página, exibe sempre o menu principal
    window.addEventListener("load", () => {
      showScreen(menuScreen);
    });

    // Cabeçalho “SOS PLACA” volta ao menu
    document
      .getElementById("header-home")
      .addEventListener("click", () => showScreen(menuScreen));

    // “Menu → Buscar/Cadastrar Placas”
    btnPlacas.addEventListener("click", () => showScreen(placasScreen));
    // “Menu → Minhas Placas”
    btnMinhasPlacas.addEventListener("click", () => {
      showMinhasPlacas();
      showScreen(minhasPlacasScreen);
    });
    // “Menu → Meu Perfil”
    btnPerfil.addEventListener("click", () => {
      mostrarPerfil();
      showScreen(perfilScreen);
    });

    // “Buscar/Cadastrar → Perdi uma placa”
    btnPerdi.addEventListener("click", () => showScreen(perdiScreen));
    // “Buscar/Cadastrar → Achei uma placa”
    btnAchei.addEventListener("click", () => showScreen(acheiScreen));

    // “Voltar” de cada tela (agora sem inline, via JS)
    btnVoltarPlacas.addEventListener("click", () => showScreen(menuScreen));
    btnVoltarMinhas.addEventListener("click", () => showScreen(menuScreen));
    btnVoltarPerfil.addEventListener("click", () => showScreen(menuScreen));
    btnVoltarLogin.addEventListener("click", () => showScreen(menuScreen));
    btnVoltarCadastro.addEventListener("click", () => showScreen(menuScreen));
    btnVoltarPerdi.addEventListener("click", () => showScreen(placasScreen));
    btnVoltarAchei.addEventListener("click", () => showScreen(placasScreen));

    // “Login”
    btnLogin.addEventListener("click", async () => {
      const email = loginEmail.value.trim();
      const senha = loginSenha.value.trim();
      loginResult.className = "result";
      loginResult.textContent = "";

      if (!email || !senha) {
        loginResult.classList.add("error");
        loginResult.textContent = "Preencha todos os campos.";
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, senha);
        loginResult.classList.add("success");
        loginResult.textContent = "Login efetuado com sucesso!";
        // Depois de um breve delay, volta ao menu
        setTimeout(() => showScreen(menuScreen), 800);
      } catch (error) {
        loginResult.classList.add("error");
        loginResult.textContent = "Erro no login: " + error.message;
      }
    });

    // “Não tem conta? Cadastre-se”
    btnIrCadastro.addEventListener("click", () => showScreen(cadastroScreen));

    // “Cadastrar”
    btnCadastrar.addEventListener("click", async () => {
      const nome = cadastroNome.value.trim();
      const email = cadastroEmail.value.trim();
      const telefone = cadastroTelefone.value.trim();
      const senha = cadastroSenha.value.trim();
      const confirmar = cadastroConfirmar.value.trim();
      cadastroResult.className = "result";
      cadastroResult.textContent = "";

      if (!nome || !email || !telefone || !senha || !confirmar) {
        cadastroResult.classList.add("error");
        cadastroResult.textContent = "Preencha todos os campos.";
        return;
      }
      if (senha !== confirmar) {
        cadastroResult.classList.add("error");
        cadastroResult.textContent = "As senhas não coincidem.";
        return;
      }
      try {
        const userCredential = await createUserWithEmailAndPassword(
          auth,
          email,
          senha
        );
        // Armazena o displayName
        await updateProfile(userCredential.user, { displayName: nome });
        cadastroResult.classList.add("success");
        cadastroResult.textContent = "Usuário criado com sucesso!";
        setTimeout(() => showScreen(menuScreen), 800);
      } catch (error) {
        cadastroResult.classList.add("error");
        cadastroResult.textContent = "Erro no cadastro: " + error.message;
      }
    });

    // ================================ “Perdi uma Placa” ================================
    // Mostra/oculta UF+Município de acordo com tipo de placa
    perdiTipo.addEventListener("change", () => {
      if (perdiTipo.value === "comum") {
        perdiLocalGroup.style.display = "block";
      } else {
        perdiLocalGroup.style.display = "none";
      }
    });
    // Estado inicial: se for “mercosul”, já oculta
    if (perdiTipo.value === "mercosul") {
      perdiLocalGroup.style.display = "none";
    }

    // Verificar Placa (perdida): consulta “foundPlates”
    perdiVerificar.addEventListener("click", async () => {
      const tipo = perdiTipo.value;
      const placa = perdiPlaca.value.trim().toUpperCase();
      const uf = perdiUf.value;
      const municipio = perdiMunicipio.value;
      perdiResult.className = "result";
      perdiResult.textContent = "";

      if (!placa) {
        perdiResult.classList.add("error");
        perdiResult.textContent = "Informe o número da placa.";
        return;
      }
      try {
        const foundCollection = collection(db, "foundPlates");
        const q = query(
          foundCollection,
          where("placa", "==", placa),
          where("tipo", "==", tipo)
        );
        const querySnapshot = await getDocs(q);
        if (!querySnapshot.empty) {
          const docFound = querySnapshot.docs[0].data();
          let mensagem = `Alguém encontrou sua placa!\n`;
          mensagem += `Nome: ${docFound.nome}\n`;
          mensagem += `Telefone: ${docFound.telefone}\n`;
          if (tipo === "comum") {
            mensagem += `Local encontrado: ${docFound.uf} / ${docFound.municipio}`;
          }
          perdiResult.classList.add("success");
          perdiResult.innerText = mensagem;
        } else {
          perdiResult.classList.add("error");
          perdiResult.textContent = "Nenhuma informação de placa encontrada.";
        }
      } catch (error) {
        perdiResult.classList.add("error");
        perdiResult.textContent = "Erro ao verificar: " + error.message;
      }
    });

    // Salvar Placa Perdida (em “lostPlates”)
    perdiSalvar.addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) {
        perdiResult.className = "result error";
        perdiResult.textContent = "Você precisa estar logado para salvar.";
        return;
      }
      const tipo = perdiTipo.value;
      const placa = perdiPlaca.value.trim().toUpperCase();
      const uf = perdiUf.value;
      const municipio = perdiMunicipio.value;
      perdiResult.className = "result";
      perdiResult.textContent = "";

      if (!placa) {
        perdiResult.classList.add("error");
        perdiResult.textContent = "Informe o número da placa.";
        return;
      }
      if (tipo === "comum" && (!uf || !municipio)) {
        perdiResult.classList.add("error");
        perdiResult.textContent = "Selecione UF e município.";
        return;
      }
      try {
        await addDoc(collection(db, "lostPlates"), {
          ownerId: user.uid,
          placa: placa,
          tipo: tipo,
          uf: tipo === "comum" ? uf : "",
          municipio: tipo === "comum" ? municipio : "",
          timestamp: Date.now(),
        });
        perdiResult.classList.add("success");
        perdiResult.textContent = "Placa perdida cadastrada com sucesso!";
        // Limpa campos
        perdiPlaca.value = "";
        if (tipo === "comum") {
          perdiUf.value = "";
          perdiMunicipio.innerHTML =
            '<option value="" disabled selected>Selecione o município</option>';
        }
      } catch (error) {
        perdiResult.classList.add("error");
        perdiResult.textContent = "Erro ao salvar: " + error.message;
      }
    });

    // ================================ “Achei uma Placa” ================================
    acheiTipo.addEventListener("change", () => {
      if (acheiTipo.value === "comum") {
        acheiLocalGroup.style.display = "block";
      } else {
        acheiLocalGroup.style.display = "none";
      }
    });
    if (acheiTipo.value === "mercosul") {
      acheiLocalGroup.style.display = "none";
    }

    acheiSalvar.addEventListener("click", async () => {
      const tipo = acheiTipo.value;
      const placa = acheiPlaca.value.trim().toUpperCase();
      const uf = acheiUf.value;
      const municipio = acheiMunicipio.value;
      const nome = acheiNome.value.trim();
      const telefone = acheiTelefone.value.trim();
      acheiResult.className = "result";
      acheiResult.textContent = "";

      if (!placa || !nome || !telefone) {
        acheiResult.classList.add("error");
        acheiResult.textContent = "Preencha todos os campos obrigatórios.";
        return;
      }
      if (tipo === "comum" && (!uf || !municipio)) {
        acheiResult.classList.add("error");
        acheiResult.textContent = "Selecione UF e município.";
        return;
      }
      try {
        await addDoc(collection(db, "foundPlates"), {
          placa: placa,
          tipo: tipo,
          uf: tipo === "comum" ? uf : "",
          municipio: tipo === "comum" ? municipio : "",
          nome: nome,
          telefone: telefone,
          timestamp: Date.now(),
        });
        acheiResult.classList.add("success");
        acheiResult.textContent = "Informação de placa encontrada salva com sucesso!";
        // Limpa campos
        acheiPlaca.value = "";
        acheiNome.value = "";
        acheiTelefone.value = "";
        if (tipo === "comum") {
          acheiUf.value = "";
          acheiMunicipio.innerHTML =
            '<option value="" disabled selected>Selecione o município</option>';
        }
      } catch (error) {
        acheiResult.classList.add("error");
        acheiResult.textContent = "Erro ao salvar: " + error.message;
      }
    });

    // ================================ “Minhas Placas Perdidas” ================================
    async function showMinhasPlacas() {
      const user = auth.currentUser;
      minhasPlacasContent.innerHTML = ""; // Limpa o conteúdo antes
      if (!user) {
        // Se não está logado, exibe mensagem + botão “Entrar”
        minhasPlacasContent.innerHTML = `
          <p>Você precisa estar logado para ver suas placas.</p>
          <button id="btn-login-minhas" class="btn btn-success">Entrar</button>
        `;
        // Associa o clique desse botão para mostrar a tela de login
        document
          .getElementById("btn-login-minhas")
          .addEventListener("click", () => showScreen(loginScreen));
        return;
      }
      try {
        const lostCollection = collection(db, "lostPlates");
        const q = query(lostCollection, where("ownerId", "==", user.uid));
        const querySnapshot = await getDocs(q);
        if (querySnapshot.empty) {
          minhasPlacasContent.innerHTML =
            "<p>Você não possui placas perdidas cadastradas.</p>";
          return;
        }
        // Para cada placa perdida, cria um card com “Verificar Status”
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const divCard = document.createElement("div");
          divCard.classList.add("plate-card");
          divCard.innerHTML = `
            <p><strong>Placa:</strong> ${data.placa} (${
            data.tipo === "comum"
              ? data.uf + " / " + data.municipio
              : "Mercosul"
          })</p>
            <button class="btn btn-success btn-verificar-status" data-placa="${
              data.placa
            }" data-tipo="${data.tipo}">
              Verificar Status
            </button>
            <div class="result status-result" style="margin-top:10px; display:none;"></div>
          `;
          minhasPlacasContent.appendChild(divCard);
        });
        // Associa evento a todos os botões “Verificar Status”
        document.querySelectorAll(".btn-verificar-status").forEach((btn) => {
          btn.addEventListener("click", async (e) => {
            const placa = e.currentTarget.getAttribute("data-placa");
            const tipo = e.currentTarget.getAttribute("data-tipo");
            const resultadoDiv = e.currentTarget.nextElementSibling;
            resultadoDiv.className = "result status-result";
            resultadoDiv.textContent = "";
            try {
              const foundCollection = collection(db, "foundPlates");
              const q2 = query(
                foundCollection,
                where("placa", "==", placa),
                where("tipo", "==", tipo)
              );
              const snap2 = await getDocs(q2);
              if (!snap2.empty) {
                const foundData = snap2.docs[0].data();
                let msg = `Sua placa foi encontrada!\n`;
                msg += `Nome: ${foundData.nome}\n`;
                msg += `Telefone: ${foundData.telefone}\n`;
                if (tipo === "comum") {
                  msg += `Local: ${foundData.uf} / ${foundData.municipio}`;
                }
                resultadoDiv.classList.add("success");
                resultadoDiv.innerText = msg;
              } else {
                resultadoDiv.classList.add("error");
                resultadoDiv.textContent = "Ainda não encontramos sua placa.";
              }
            } catch (error) {
              resultadoDiv.classList.add("error");
              resultadoDiv.textContent =
                "Erro ao verificar status: " + error.message;
            }
            resultadoDiv.style.display = "block";
          });
        });
      } catch (error) {
        minhasPlacasContent.innerHTML = `<p class="error">Erro ao buscar suas placas: ${error.message}</p>`;
      }
    }

    // ================================ “Meu Perfil” ================================
    async function mostrarPerfil() {
      const user = auth.currentUser;
      perfilContent.innerHTML = "";
      if (!user) {
        // Se não está logado, exibe mensagem + botão “Entrar”
        perfilContent.innerHTML = `
          <p>Você precisa estar logado para ver o perfil.</p>
          <button id="btn-login-perfil" class="btn btn-success">Entrar</button>
        `;
        document
          .getElementById("btn-login-perfil")
          .addEventListener("click", () => showScreen(loginScreen));
        return;
      }
      const nome = user.displayName || "(sem nome)";
      const email = user.email || "(sem e-mail)";
      perfilContent.innerHTML = `
        <div class="profile-info">
          <p><strong>Nome:</strong> ${nome}</p>
          <p><strong>E-mail:</strong> ${email}</p>
          <p><strong>Telefone:</strong> ${user.phoneNumber || "-"}</p>
          <button id="btn-logout" class="btn btn-danger" style="margin-top:15px;">Sair</button>
        </div>
      `;
      document
        .getElementById("btn-logout")
        .addEventListener("click", async () => {
          await signOut(auth);
          showScreen(menuScreen);
        });
    }
  </script>
</body>
</html>
