<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOS PLACA</title>
  <link rel="icon" type="image/png" href="logo.png">

  <style>
    @font-face {
      font-family: 'JostBold';
      src: url('jostbold.ttf') format('truetype');
    }
    @font-face {
      font-family: 'JostMedium';
      src: url('jostmedium.ttf') format('truetype');
    }
    @font-face {
      font-family: 'JostRegular';
      src: url('jostregular.ttf') format('truetype');
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'JostRegular', sans-serif; }
    body { background-color: #FAFAFA; color: #333; line-height: 1.6; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    header {
      background-color: #0077B6;
      color: #fff;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 0 0 10px 10px;
    }
    .logo-container { display: flex; align-items: center; gap: 10px; }
    .logo-img { width: 50px; height: 50px; }
    .logo-text { font-size: 2rem; font-family: 'JostBold'; }
    h1 { font-size: 1.2rem; }

    .screen {
      background-color: #fff;
      padding: 24px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: none;
    }
    .screen.active { display: block; }

    .btn {
      display: inline-block;
      background-color: #023E8A;
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 5px 3px;
    }
    .btn-success { background-color: #F8961E; }
    .btn-secondary { background-color: #ADB5BD; }
    .btn-danger { background-color: #e74c3c; }
    .btn-toggle {
      background-color: #ccc;
      color: #000;
      border: 1px solid #999;
    }
    .btn-toggle.active {
      background-color: #023E8A;
      color: #fff;
    }

    .form-group { margin-bottom: 1.25rem; }
    label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }

    .result {
      margin-top: 1rem;
      padding: 0.9375rem;
      border-radius: 6px;
      background-color: #f8f9fa;
      display: none;
    }
    .result.success { display: block; border-left: 6px solid #27ae60; }
    .result.error { display: block; border-left: 6px solid #e74c3c; }

    .alert-box {
      background-color: #fff8e1;
      border-left: 6px solid #f1c40f;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
    }

    footer {
      background-color: #023E8A;
      color: white;
      padding: 15px;
      text-align: center;
      border-radius: 10px 10px 0 0;
      margin-top: 30px;
    }

    @media (max-width:600px) {
      header { flex-direction: column; gap: 10px; }
      h1 { text-align: center; }
    }
  </style>
</head>

<body>
<header>
  <div class="logo-container">
    <img src="logo.png" alt="Logo SOS Placa" class="logo-img">
    <div class="logo-text">SOS PLACA</div>
  </div>
  <h1>Se achou, avise! Se perdeu, procure aqui!</h1>
  <a href="https://play.google.com/store/apps/details?id=fabricioramosdasilva.sos_placa" target="_blank">
    <img src="GooglePlay.png" alt="Baixar na Google Play" style="height: 90px;">
  </a>
</header>

<div class="container">

<!-- üîπ Menu Inicial -->
<div id="menu-screen" class="screen active">
  <h2>O que voc√™ deseja fazer?</h2>
  <button onclick="abrirTela('perdi-screen')" class="btn">Perdi uma placa</button>
  <button onclick="abrirTela('achei-screen')" class="btn">Achei uma placa</button>
</div>
<!-- üîπ Tela Perdi uma Placa -->
<div id="perdi-screen" class="screen">
  <h2>Perdi uma Placa</h2>

  <!-- Bot√µes de Tipo -->
  <div class="form-group">
    <label>Tipo de Placa:</label>
    <button id="btn-perdi-comum" class="btn btn-toggle active" onclick="alternarTipo('perdi','comum')">Comum</button>
    <button id="btn-perdi-mercosul" class="btn btn-toggle" onclick="alternarTipo('perdi','mercosul')">Mercosul</button>
  </div>

  <!-- N√∫mero da Placa -->
  <div class="form-group">
    <label for="perdi-placa">N√∫mero da Placa:</label>
    <input type="text" id="perdi-placa" placeholder="Ex: ABC1234 ou ABC1D23">
  </div>

  <!-- Localiza√ß√£o (exibe s√≥ para Comum) -->
  <div id="perdi-localizacao">
    <div class="form-group">
      <label for="perdi-uf">Estado (UF):</label>
      <select id="perdi-uf">
        <option value="" disabled selected>Selecione o estado</option>
      </select>
    </div>
    <div class="form-group">
      <label for="perdi-municipio">Munic√≠pio:</label>
      <select id="perdi-municipio">
        <option value="" disabled selected>Selecione o munic√≠pio</option>
      </select>
    </div>
  </div>

  <button id="perdi-verificar" class="btn btn-success">Verificar Placa</button>
  <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
  <div id="perdi-result" class="result"></div>
</div>

<!-- üîπ Tela Achei uma Placa -->
<div id="achei-screen" class="screen">
  <h2>Achei uma Placa</h2>

  <!-- Bot√µes de Tipo -->
  <div class="form-group">
    <label>Tipo de Placa:</label>
    <button id="btn-achei-comum" class="btn btn-toggle active" onclick="alternarTipo('achei','comum')">Comum</button>
    <button id="btn-achei-mercosul" class="btn btn-toggle" onclick="alternarTipo('achei','mercosul')">Mercosul</button>
  </div>

  <!-- N√∫mero da Placa -->
  <div class="form-group">
    <label for="achei-placa">N√∫mero da Placa:</label>
    <input type="text" id="achei-placa" placeholder="Ex: ABC1234 ou ABC1D23">
  </div>

  <!-- Localiza√ß√£o (exibe s√≥ para Comum) -->
  <div id="achei-localizacao">
    <div class="form-group">
      <label for="achei-uf">Estado (UF):</label>
      <select id="achei-uf">
        <option value="" disabled selected>Selecione o estado</option>
      </select>
    </div>
    <div class="form-group">
      <label for="achei-municipio">Munic√≠pio:</label>
      <select id="achei-municipio">
        <option value="" disabled selected>Selecione o munic√≠pio</option>
      </select>
    </div>
  </div>

  <!-- Dados do Encontrador -->
  <div class="form-group">
    <label for="achei-nome">Seu nome:</label>
    <input type="text" id="achei-nome" placeholder="Digite seu nome">
  </div>

  <div class="form-group">
    <label for="achei-telefone">Telefone para contato:</label>
    <input type="tel" id="achei-telefone" placeholder="(00) 00000-0000">
  </div>

  <button id="achei-salvar" class="btn btn-success">Salvar Placa</button>
  <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
  <div id="achei-result" class="result"></div>
</div>
<script type="module">
  // üî• Firebase Config
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBjetihGmlo_z01jx-GW9Ith0oDCS0jwYc",
    authDomain: "sosplaca-73cf7.firebaseapp.com",
    databaseURL: "https://sosplaca-73cf7-default-rtdb.firebaseio.com",
    projectId: "sosplaca-73cf7",
    storageBucket: "sosplaca-73cf7.appspot.com",
    messagingSenderId: "658059385722",
    appId: "1:658059385722:web:5ed0e8fd7f7a2931d894c3"
  };

  const app = initializeApp(firebaseConfig);
  const firestore = getFirestore(app);
  const realtimeDb = getDatabase(app);

  // üîó Altern√¢ncia de Telas
  function abrirTela(telaId) {
    document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
    document.getElementById(telaId).classList.add('active');
  }

  function voltarMenu() {
    abrirTela('menu-screen');
  }

  // üîÑ Altern√¢ncia de tipo (Comum/Mercosul)
  function alternarTipo(contexto, tipo) {
    const btnComum = document.getElementById(`btn-${contexto}-comum`);
    const btnMercosul = document.getElementById(`btn-${contexto}-mercosul`);
    const localizacao = document.getElementById(`${contexto}-localizacao`);

    if (tipo === 'comum') {
      btnComum.classList.add('active');
      btnMercosul.classList.remove('active');
      localizacao.style.display = 'block';
    } else {
      btnMercosul.classList.add('active');
      btnComum.classList.remove('active');
      localizacao.style.display = 'none';
    }
  }

  // üåé Estados e Munic√≠pios
  const cidadesPorEstado = {
    SP: ["Ubatuba", "S√£o Paulo"],
    RJ: ["Rio de Janeiro", "Niter√≥i"],
    MG: ["Belo Horizonte", "Uberl√¢ndia"],
    PR: ["Curitiba", "Londrina"]
  };

  function preencherUF(selectId) {
    const select = document.getElementById(selectId);
    select.innerHTML = '<option value="" disabled selected>Selecione o estado</option>';
    Object.keys(cidadesPorEstado).forEach(uf => {
      const option = document.createElement('option');
      option.value = uf;
      option.textContent = uf;
      select.appendChild(option);
    });
  }

  function atualizarMunicipios(ufSelectId, municipioSelectId) {
    const uf = document.getElementById(ufSelectId).value;
    const municipioSelect = document.getElementById(municipioSelectId);
    municipioSelect.innerHTML = '<option value="" disabled selected>Selecione o munic√≠pio</option>';

    if (cidadesPorEstado[uf]) {
      cidadesPorEstado[uf].forEach(cidade => {
        const option = document.createElement('option');
        option.value = cidade;
        option.textContent = cidade;
        municipioSelect.appendChild(option);
      });
    }
  }

  document.getElementById('perdi-uf').addEventListener('change', () => atualizarMunicipios('perdi-uf', 'perdi-municipio'));
  document.getElementById('achei-uf').addEventListener('change', () => atualizarMunicipios('achei-uf', 'achei-municipio'));

  document.addEventListener('DOMContentLoaded', () => {
    preencherUF('perdi-uf');
    preencherUF('achei-uf');
  });

  // üîç Verificar Placa
  document.getElementById("perdi-verificar").addEventListener("click", async () => {
    const placaInput = document.getElementById("perdi-placa").value.trim().toUpperCase().replace(/[^A-Z0-9]/g, "");
    const tipo = document.getElementById('btn-perdi-comum').classList.contains('active') ? 'comum' : 'mercosul';
    const uf = document.getElementById('perdi-uf').value;
    const municipio = document.getElementById('perdi-municipio').value;
    const resultDiv = document.getElementById("perdi-result");

    resultDiv.className = "result";
    resultDiv.innerHTML = "";
    resultDiv.style.display = "none";

    if (!placaInput) {
      resultDiv.classList.add("error");
      resultDiv.innerHTML = `<p>Informe a placa.</p>`;
      resultDiv.style.display = "block";
      return;
    }

    try {
      const path = tipo === 'comum' ? `${placaInput}:${uf}:${municipio}` : `${placaInput}:null:null`;
      const colRef = collection(firestore, "foundPlates");
      const q = query(colRef, where("path", "==", path));
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        resultDiv.classList.add("error");
        resultDiv.innerHTML = `<p>‚ùå Infelizmente ainda n√£o encontramos essa placa.<br>Continue tentando!</p>`;
      } else {
        let html = "";
        snapshot.forEach(doc => {
          const dados = doc.data();
          const nome = dados.name || "Pessoa n√£o identificada";
          const telefone = dados.phone || "";
          const soNumeros = telefone.replace(/\D/g, "");

          html += `<p><strong>Boa not√≠cia!</strong> A placa <strong>${placaInput}</strong> foi encontrada por <strong>${nome}</strong>.</p>`;

          if (soNumeros.length >= 10) {
            const mensagem = encodeURIComponent(`Ol√° ${nome}! Vi que voc√™ cadastrou a placa ${placaInput} no SOS Placa ‚Äì ela √© do meu ve√≠culo! Se ainda tiver a√≠, me avisa como posso buscar, por favor!`);
            html += `<a href="https://wa.me/55${soNumeros}?text=${mensagem}" target="_blank">
                      <img src="WhatsApp.png" alt="WhatsApp" style="height: 50px; margin-top: 10px;">
                     </a>`;
          }

          html += `<div class="alert-box">
                     <strong>‚ö†Ô∏è Aten√ß√£o:</strong><br>
                     N√£o cobramos e nem intermediamos qualquer valor pela devolu√ß√£o de placas.<br>
                     Oferecer uma gratifica√ß√£o √© algo opcional, decidido entre quem perdeu e quem encontrou.<br>
                     Se achar necess√°rio, entre em contato com as autoridades.
                   </div>`;
        });

        resultDiv.classList.add("success");
        resultDiv.innerHTML = html;
      }

      resultDiv.style.display = "block";

    } catch (error) {
      console.error("Erro ao buscar placa:", error);
      resultDiv.classList.add("error");
      resultDiv.innerHTML = `<p>Houve um erro ao verificar a placa. Tente novamente em instantes.</p>`;
      resultDiv.style.display = "block";
    }
  });

  // ‚úÖ Cadastrar Placa Encontrada
  document.getElementById("achei-salvar").addEventListener("click", async () => {
    const placa = document.getElementById("achei-placa").value.trim().toUpperCase().replace(/[^A-Z0-9]/g, "");
    const tipo = document.getElementById('btn-achei-comum').classList.contains('active') ? 'comum' : 'mercosul';
    const uf = document.getElementById('achei-uf').value;
    const municipio = document.getElementById('achei-municipio').value;
    const nome = document.getElementById('achei-nome').value.trim();
    const telefone = document.getElementById('achei-telefone').value.trim();
    const resultDiv = document.getElementById("achei-result");

    resultDiv.className = "result";
    resultDiv.innerHTML = "";
    resultDiv.style.display = "none";

    if (!placa || !nome || !telefone || (tipo === 'comum' && (!uf || !municipio))) {
      resultDiv.classList.add("error");
      resultDiv.innerHTML = `<p>Preencha todos os campos obrigat√≥rios.</p>`;
      resultDiv.style.display = "block";
      return;
    }

    try {
      const path = tipo === 'comum' ? `${placa}:${uf}:${municipio}` : `${placa}:null:null`;

      await addDoc(collection(firestore, "foundPlates"), {
        plate: placa,
        type: tipo,
        uf: tipo === 'comum' ? uf : '',
        city: tipo === 'comum' ? municipio : '',
        name: nome,
        phone: telefone,
        createdAt: serverTimestamp(),
        path: path
      });

      await set(ref(realtimeDb, `${path}:true`), true);

      resultDiv.classList.add("success");
      resultDiv.innerHTML = `<p>‚úÖ Placa cadastrada com sucesso!</p>`;
      resultDiv.style.display = "block";

    } catch (error) {
      console.error("Erro ao salvar:", error);
      resultDiv.classList.add("error");
      resultDiv.innerHTML = `<p>Houve um erro ao salvar a placa. Tente novamente.</p>`;
      resultDiv.style.display = "block";
    }
  });
</script>
<footer>
  üíô Ajude a manter esse projeto!<br>
  <strong>PIX:</strong> sosplaca.app@gmail.com
</footer>

</div> <!-- Fecha .container -->
</body>
</html>
