<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOS PLACA</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

    <!-- CSS -->
    <style>
        body {
            font-family: 'Jost', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #333;
        }

        .btn {
            background-color: #0077cc;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
        }

        .btn:hover {
            background-color: #005fa3;
        }

        .form-group {
            margin: 15px 0;
        }

        input, select {
            padding: 10px;
            width: 80%;
            max-width: 300px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .mini-img {
            width: 100px;
            display: block;
            margin: 10px auto;
        }

        .hidden {
            display: none;
        }

        .whatsapp-button {
            background-color: #25d366;
        }

        .whatsapp-button:hover {
            background-color: #1ebe57;
        }
    </style>
</head>

<body>

    <h1>SOS PLACA</h1>

    <!-- Menu Inicial -->
    <div id="menu">
        <button class="btn" onclick="abrirPerdi()">Perdi</button>
        <button class="btn" onclick="abrirAchei()">Achei</button>
    </div>

    <!-- Tela Perdi -->
    <div id="perdi" class="hidden">
        <h2>Buscar Placa Perdida</h2>

        <div class="form-group">
            <label>Tipo de Placa:</label><br>
            <select id="tipoPlacaPerdi" onchange="atualizarImagem('perdi')">
                <option value="comum">Comum</option>
                <option value="mercosul">Mercosul</option>
            </select><br>
            <img id="imgPlacaPerdi" src="comum.png" class="mini-img">
        </div>

        <div class="form-group">
            <input type="text" id="placaPerdi" placeholder="Digite a placa" oninput="formatarPlaca('perdi')">
        </div>

        <button class="btn" onclick="buscarPlaca()">Buscar</button><br><br>
        <button class="btn" onclick="voltarMenu()">Voltar ao Menu</button>

        <div id="resultadoPerdi"></div>
    </div>

    <!-- Tela Achei -->
    <div id="achei" class="hidden">
        <h2>Cadastro de Placa Encontrada</h2>

        <div class="form-group">
            <label>Tipo de Placa:</label><br>
            <select id="tipoPlacaAchei" onchange="atualizarImagem('achei')">
                <option value="comum">Comum</option>
                <option value="mercosul">Mercosul</option>
            </select><br>
            <img id="imgPlacaAchei" src="comum.png" class="mini-img">
        </div>

        <div class="form-group">
            <input type="text" id="placaAchei" placeholder="Digite a placa" oninput="formatarPlaca('achei')">
        </div>

        <div class="form-group">
            <input type="text" id="nomeAchei" placeholder="Digite seu nome">
        </div>

        <div class="form-group">
            <input type="text" id="telefoneAchei" placeholder="Digite seu telefone">
        </div>

        <button class="btn" onclick="cadastrarPlaca()">Cadastrar</button><br><br>
        <button class="btn" onclick="voltarMenu()">Voltar ao Menu</button>
    </div>

    <!-- Firebase Config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyClzqFmEL9y_ugHnC7V4DnFiANX6RLDYzc",
            authDomain: "teste-c702e.firebaseapp.com",
            databaseURL: "https://teste-c702e-default-rtdb.firebaseio.com",
            projectId: "teste-c702e",
            storageBucket: "teste-c702e.appspot.com",
            messagingSenderId: "478905955045",
            appId: "1:478905955045:web:bb9d0623db8a9166e85a0c"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        firebase.auth().signInAnonymously();

        // Telas
        function abrirPerdi() {
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('perdi').classList.remove('hidden');
        }

        function abrirAchei() {
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('achei').classList.remove('hidden');
        }

        function voltarMenu() {
            document.getElementById('perdi').classList.add('hidden');
            document.getElementById('achei').classList.add('hidden');
            document.getElementById('resultadoPerdi').innerHTML = '';
            document.getElementById('menu').classList.remove('hidden');
        }

        function atualizarImagem(tela) {
            const tipo = document.getElementById(`tipoPlaca${tela.charAt(0).toUpperCase() + tela.slice(1)}`).value;
            const img = document.getElementById(`imgPlaca${tela.charAt(0).toUpperCase() + tela.slice(1)}`);
            img.src = tipo === 'mercosul' ? 'mercosul.png' : 'comum.png';
        }

        // Máscara telefone
        function formatarTelefone(valor) {
            const limpo = valor.replace(/\D/g, '');
            if (limpo.length <= 10) {
                return limpo.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else {
                return limpo.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            }
        }

        document.getElementById('telefoneAchei').addEventListener('input', function(e) {
            e.target.value = formatarTelefone(e.target.value);
        });

        // Validação e formatação de placa
        function formatarPlaca(tela) {
            const tipo = document.getElementById(`tipoPlaca${tela.charAt(0).toUpperCase() + tela.slice(1)}`).value;
            const input = document.getElementById(`placa${tela.charAt(0).toUpperCase() + tela.slice(1)}`);
            let valor = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');

            if (tipo === 'comum') {
                valor = valor
                    .replace(/^([A-Z]{0,3})/, '$1')
                    .replace(/^([A-Z]{3})(\d{0,4})/, '$1-$2');
                valor = valor.substring(0, 8);
            } else if (tipo === 'mercosul') {
                valor = valor
                    .replace(/^([A-Z]{0,3})/, '$1')
                    .replace(/^([A-Z]{3})(\d{0,1})/, '$1$2')
                    .replace(/^([A-Z]{3}\d{1})([A-Z]{0,1})/, '$1$2')
                    .replace(/^([A-Z]{3}\d{1}[A-Z]{1})(\d{0,2})/, '$1$2');
                valor = valor.substring(0, 7);
            }

            input.value = valor;
        }

        // Cadastrar
        function cadastrarPlaca() {
            const placa = document.getElementById('placaAchei').value.toUpperCase();
            const nome = document.getElementById('nomeAchei').value;
            const telefone = document.getElementById('telefoneAchei').value;

            if (!placa || !nome || !telefone) {
                alert('Preencha todos os campos!');
                return;
            }

            const ref = database.ref('placas/' + placa);
            ref.once('value', snapshot => {
                if (snapshot.exists()) {
                    alert('Essa placa já está cadastrada como encontrada.');
                } else {
                    ref.set({
                        nome: nome,
                        telefone: telefone
                    });
                    alert('Cadastro realizado com sucesso! Agora é só aguardar. Parabéns pela sua atitude!');
                    location.reload();
                }
            });
        }

        // Buscar
        function buscarPlaca() {
            const placa = document.getElementById('placaPerdi').value.toUpperCase();
            const resultado = document.getElementById('resultadoPerdi');
            resultado.innerHTML = '';

            const ref = database.ref('placas/' + placa);
            ref.once('value', snapshot => {
                if (snapshot.exists()) {
                    const dados = snapshot.val();
                    const telefoneFormatado = dados.telefone.replace(/\D/g, '');
                    resultado.innerHTML = `
                        <p><strong>Placa Encontrada!</strong><br>
                        Anote o telefone e não esqueça de clicar em REMOVER.<br><br>
                        <strong>Nome:</strong> ${dados.nome}<br>
                        <strong>Telefone:</strong> ${dados.telefone}</p>
                        <a class="btn whatsapp-button" href="https://wa.me/55${telefoneFormatado}?text=Olá! Vi através do site SOS PLACA que você encontrou a placa do meu carro." target="_blank">Falar no WhatsApp</a><br><br>
                        <button class="btn" onclick="removerPlaca('${placa}')">Remover</button>
                    `;
                } else {
                    resultado.innerHTML = '<p>Não encontramos essa placa. Tente novamente mais tarde.</p>';
                }
            });
        }

        // Remover
        function removerPlaca(placa) {
            const ref = database.ref('placas/' + placa);
            ref.remove().then(() => {
                alert('Placa removida com sucesso!');
                location.reload();
            });
        }
    </script>

</body>
</html>
