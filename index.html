<!-- 🏁 Cabeçalho -->
<header>
  <div class="logo-container">
    <img src="logo.png" alt="Logo SOS Placa" class="logo-img">
    <div class="logo-text">SOS PLACA</div>
  </div>
  <a href="https://play.google.com/store/apps/details?id=seu.id.aqui" target="_blank">
    <img src="GooglePlay.png" alt="Baixar na Google Play" style="height: 50px;">
  </a>
</header>

<div class="container">

  <!-- 🏠 Menu Inicial -->
  <div id="menu-screen" class="screen active">
    <h2>O que você deseja fazer?</h2>
    <button id="btn-placas" class="btn">Buscar / Cadastrar Placas</button>
    <button id="btn-minhas-placas" class="btn">Minhas Placas</button>
    <button id="btn-perfil" class="btn">Perfil</button>
  </div>

  <!-- 🚘 Tela Placas (Perdi / Achei) -->
  <div id="placas-screen" class="screen">
    <h2>Placas</h2>
    <button id="btn-perdi" class="btn">Perdi uma placa</button>
    <button id="btn-achei" class="btn">Achei uma placa</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
  </div>

  <!-- 📋 Tela Minhas Placas -->
  <div id="minhas-placas-screen" class="screen">
    <h2>Minhas Placas</h2>
    <div id="lista-minhas-placas"></div>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
  </div>

  <!-- 👤 Tela Perfil -->
  <div id="perfil-screen" class="screen">
    <h2>Perfil</h2>
    <div id="perfil-conteudo"></div>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
  </div>

  <!-- 🔐 Tela Login -->
  <div id="login-screen" class="screen">
    <h2>Entre com sua conta!</h2>
    <div class="form-group">
      <label for="login-email">Email:</label>
      <input type="email" id="login-email" placeholder="Digite seu email">
    </div>
    <div class="form-group">
      <label for="login-senha">Senha:</label>
      <input type="password" id="login-senha" placeholder="Digite sua senha">
    </div>
    <button id="login-btn" class="btn btn-success">Entrar</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    <p style="margin-top: 15px;">Não tem uma conta? <a href="#" id="link-registro">Crie uma aqui!</a></p>
    <div id="login-result" class="result"></div>
  </div>

  <!-- 🆕 Tela Registro -->
  <div id="registro-screen" class="screen">
    <h2>Registro</h2>
    <div class="form-group">
      <label for="registro-nome">Nome:</label>
      <input type="text" id="registro-nome" placeholder="Seu nome completo">
    </div>
    <div class="form-group">
      <label for="registro-email">Email:</label>
      <input type="email" id="registro-email" placeholder="Digite seu email">
    </div>
    <div class="form-group">
      <label for="registro-telefone">Telefone:</label>
      <input type="tel" id="registro-telefone" placeholder="(00) 00000-0000">
    </div>
    <div class="form-group">
      <label for="registro-senha">Senha:</label>
      <input type="password" id="registro-senha" placeholder="Crie uma senha">
    </div>
    <div class="form-group">
      <label for="registro-confirmar">Confirmar Senha:</label>
      <input type="password" id="registro-confirmar" placeholder="Confirme sua senha">
    </div>
    <button id="registro-btn" class="btn btn-success">Registrar-se</button>
    <button class="btn btn-secondary" onclick="voltarMenu()">Voltar</button>
    <div id="registro-result" class="result"></div>
  </div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged,
    updateProfile
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  // 🔗 Firebase Config (coloque aqui o seu real config)
const firebaseConfig = {
            apiKey: "AIzaSyBjetihGmlo_z01jx-GW9Ith0oDCS0jwYc",
            authDomain: "sosplaca-73cf7.firebaseapp.com",
            databaseURL: "https://sosplaca-73cf7-default-rtdb.firebaseio.com",
            projectId: "sosplaca-73cf7",
            storageBucket: "sosplaca-73cf7.appspot.com",
            messagingSenderId: "658059385722",
            appId: "1:658059385722:web:5ed0e8fd7f7a2931d894c3"
        };

  const app = initializeApp(firebaseConfig);
  const firestore = getFirestore(app);
  const realtimeDb = getDatabase(app);
  const auth = getAuth(app);

  // 🔄 Atualiza botões conforme login
  onAuthStateChanged(auth, async (user) => {
    const perfilConteudo = document.getElementById('perfil-conteudo');
    if (user) {
      const q = query(collection(firestore, "users"), where("uid", "==", user.uid));
      const querySnapshot = await getDocs(q);
      if (!querySnapshot.empty) {
        const data = querySnapshot.docs[0].data();
        perfilConteudo.innerHTML = `
          <p><strong>Nome:</strong> ${data.nome}</p>
          <p><strong>Email:</strong> ${data.email}</p>
          <p><strong>Telefone:</strong> ${data.telefone}</p>
          <button id="logout-btn" class="btn btn-danger">Sair</button>
        `;
      } else {
        perfilConteudo.innerHTML = `
          <p><strong>Nome:</strong> ${user.displayName}</p>
          <p><strong>Email:</strong> ${user.email}</p>
          <p><strong>Telefone:</strong> (não informado)</p>
          <button id="logout-btn" class="btn btn-danger">Sair</button>
        `;
      }

      document.getElementById('logout-btn').addEventListener('click', async () => {
        await signOut(auth);
        voltarMenu();
      });

    } else {
      perfilConteudo.innerHTML = `
        <p>Você precisa estar logado para ver suas informações.</p>
        <button class="btn btn-warning" onclick="mostrarTela('login-screen')">Fazer login</button>
      `;
    }
  });

  // 🆕 Registro
  document.getElementById('registro-btn').addEventListener('click', async () => {
    const nome = document.getElementById('registro-nome').value.trim();
    const email = document.getElementById('registro-email').value.trim();
    const telefone = document.getElementById('registro-telefone').value.trim();
    const senha = document.getElementById('registro-senha').value.trim();
    const confirmar = document.getElementById('registro-confirmar').value.trim();
    const result = document.getElementById('registro-result');
    result.style.display = 'none';

    if (!nome || !email || !telefone || !senha || !confirmar) {
      result.textContent = 'Preencha todos os campos.';
      result.style.display = 'block';
      return;
    }

    if (senha !== confirmar) {
      result.textContent = 'As senhas não conferem.';
      result.style.display = 'block';
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
      await updateProfile(userCredential.user, { displayName: nome });

      await addDoc(collection(firestore, "users"), {
        uid: userCredential.user.uid,
        nome,
        email,
        telefone
      });

      result.textContent = 'Conta criada com sucesso!';
      result.style.display = 'block';
      setTimeout(() => voltarMenu(), 1000);
    } catch (error) {
      console.error('Erro no registro:', error);
      result.textContent = 'Erro no registro. Verifique os dados.';
      result.style.display = 'block';
    }
  });

  // 🔑 Login
  document.getElementById('login-btn').addEventListener('click', async () => {
    const email = document.getElementById('login-email').value.trim();
    const senha = document.getElementById('login-senha').value.trim();
    const result = document.getElementById('login-result');
    result.style.display = 'none';

    if (!email || !senha) {
      result.textContent = 'Preencha todos os campos.';
      result.style.display = 'block';
      return;
    }

    try {
      await signInWithEmailAndPassword(auth, email, senha);
      result.textContent = 'Login realizado com sucesso!';
      result.style.display = 'block';
      setTimeout(() => voltarMenu(), 1000);
    } catch (error) {
      console.error('Erro no login:', error);
      result.textContent = 'Erro no login. Verifique seus dados.';
      result.style.display = 'block';
    }
  });

  // 🔗 Link Login → Registro
  document.getElementById('link-registro').addEventListener('click', () => {
    mostrarTela('registro-screen');
  });

  // 🧭 Menu de navegação principal
  document.getElementById('btn-placas').addEventListener('click', () => mostrarTela('placas-screen'));
  document.getElementById('btn-minhas-placas').addEventListener('click', () => mostrarTela('minhas-placas-screen'));
  document.getElementById('btn-perfil').addEventListener('click', () => mostrarTela('perfil-screen'));
</script>
// 📋 Minhas Placas — Consultar placas cadastradas como perdidas
document.getElementById('btn-minhas-placas').addEventListener('click', async () => {
  mostrarTela('minhas-placas-screen');
  const user = auth.currentUser;
  const container = document.getElementById('lista-minhas-placas');
  container.innerHTML = 'Carregando...';

  if (!user) {
    container.innerHTML = `
      <p>Você precisa estar logado para acessar essa página!</p>
      <button class="btn btn-warning" onclick="mostrarTela('login-screen')">Fazer login</button>
    `;
    return;
  }

  try {
    const q = query(collection(firestore, 'lostPlates'), where('userId', '==', user.uid));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
      container.innerHTML = 'Você não possui placas cadastradas como perdidas.';
      return;
    }

    let html = '';

    for (const doc of querySnapshot.docs) {
      const data = doc.data();
      const placa = data.plate;
      const isComum = data.isComum;
      const uf = data.uf;
      const cidade = data.city;

      const keyRealtime = isComum
        ? `${placa}:${uf}:${cidade}`
        : `${placa}:null:null`;

      const snapshot = await get(child(ref(realtimeDb), keyRealtime));

      if (snapshot.exists()) {
        // ✅ Placa encontrada
        html += `
          <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
            <strong>Placa:</strong> ${placa}<br>
            <button onclick="mostrarDetalhesPlaca('${placa}')" 
              style="background-color: #2ecc71; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 600;">
              ✔️ ENCONTRADA — Ver mais detalhes
            </button>
          </div>
        `;
      } else {
        // ❌ Placa ainda não encontrada
        html += `
          <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
            <strong>Placa:</strong> ${placa}<br>
            <button onclick="alert('Ainda não foi encontrada.')" 
              style="background-color: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 600;">
              ❌ NÃO ENCONTRADA — Ver mais detalhes
            </button>
          </div>
        `;
      }
    }

    container.innerHTML = html;

  } catch (error) {
    console.error('Erro ao carregar suas placas:', error);
    container.innerHTML = 'Erro ao carregar suas placas.';
  }
});

// 🔍 Mostrar detalhes da placa encontrada
async function mostrarDetalhesPlaca(placa) {
  try {
    const q = query(collection(firestore, 'foundPlates'), where('plate', '==', placa));
    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      const data = querySnapshot.docs[0].data();
      alert(`Placa ${placa} foi encontrada!\n\nResponsável: ${data.founderName}\nTelefone: ${data.founderPhone}`);
    } else {
      alert('Dados do responsável não encontrados.');
    }
  } catch (error) {
    console.error('Erro ao buscar detalhes:', error);
    alert('Erro ao buscar detalhes.');
  }
}
<script>
  // 🔀 Navegação entre telas
  function mostrarTela(id) {
    document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function voltarMenu() {
    mostrarTela('menu-screen');
  }
  window.voltarMenu = voltarMenu;

  // 🔥 Máscara de telefone (campo "Achei uma placa")
  const telInput = document.getElementById('achei-telefone');
  if (telInput) {
    telInput.addEventListener('input', function () {
      let value = this.value.replace(/\D/g, '').slice(0, 11);
      if (value.length > 2) value = `(${value.substring(0, 2)}) ${value.substring(2)}`;
      if (value.length > 10) value = `${value.substring(0, 10)}-${value.substring(10)}`;
      this.value = value;
    });
  }

  // 🔥 Máscara de placas (comum/mercosul)
  function aplicarMascaraPlaca(inputId, isComum) {
    const input = document.getElementById(inputId);
    if (!input) return;
    let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    if (isComum) {
      value = value.slice(0, 7);
      if (value.length > 3) value = `${value.slice(0, 3)}-${value.slice(3)}`;
    } else {
      value = value.slice(0, 7);
    }
    input.value = value;
  }

  const acheiInput = document.getElementById('achei-placa');
  if (acheiInput) {
    acheiInput.addEventListener('input', function () {
      const isComum = document.getElementById('btn-achei-comum')?.classList.contains('ativo');
      aplicarMascaraPlaca('achei-placa', isComum);
    });
  }

  const perdiInput = document.getElementById('perdi-placa');
  if (perdiInput) {
    perdiInput.addEventListener('input', function () {
      const isComum = document.getElementById('btn-perdi-comum')?.classList.contains('ativo');
      aplicarMascaraPlaca('perdi-placa', isComum);
    });
  }

  // 🔥 UF → Município
  const cidadesPorEstado = {
    SP: ["Ubatuba", "Caraguatatuba", "São Paulo", "Campinas"],
    RJ: ["Rio de Janeiro", "Niterói", "Petrópolis"],
    MG: ["Belo Horizonte", "Uberlândia", "Contagem"]
  };

  function atualizarMunicipios(ufId, municipioId) {
    const uf = document.getElementById(ufId)?.value;
    const municipioSelect = document.getElementById(municipioId);
    if (!municipioSelect || !uf) return;

    municipioSelect.innerHTML = '<option value="" disabled selected>Selecione o município</option>';

    if (cidadesPorEstado[uf]) {
      cidadesPorEstado[uf].forEach(cidade => {
        const option = document.createElement('option');
        option.value = cidade;
        option.textContent = cidade;
        municipioSelect.appendChild(option);
      });
    }
  }

  document.getElementById('achei-uf')?.addEventListener('change', () => atualizarMunicipios('achei-uf', 'achei-municipio'));
  document.getElementById('perdi-uf')?.addEventListener('change', () => atualizarMunicipios('perdi-uf', 'perdi-municipio'));

  // 🔘 Botões tipo de placa — Achei
  document.querySelectorAll('#btn-achei-comum, #btn-achei-mercosul').forEach(btn => {
    btn.addEventListener('click', function () {
      document.querySelectorAll('#achei-screen .btn').forEach(b => b.classList.remove('ativo'));
      this.classList.add('ativo');
      const isComum = this.id === 'btn-achei-comum';
      document.getElementById('achei-placa').placeholder = isComum ? 'AAA-0000' : 'AAA0A00';
      document.getElementById('achei-localizacao').style.display = isComum ? 'block' : 'none';
    });
  });

  // 🔘 Botões tipo de placa — Perdi
  document.querySelectorAll('#btn-perdi-comum, #btn-perdi-mercosul').forEach(btn => {
    btn.addEventListener('click', function () {
      document.querySelectorAll('#perdi-screen .btn').forEach(b => b.classList.remove('ativo'));
      this.classList.add('ativo');
      const isComum = this.id === 'btn-perdi-comum';
      document.getElementById('perdi-placa').placeholder = isComum ? 'AAA-0000' : 'AAA0A00';
      document.getElementById('perdi-localizacao').style.display = isComum ? 'block' : 'none';
    });
  });

  // ✅ Se desejar: WhatsApp automático para contato
  // Exemplo:
  // const link = `https://wa.me/55${telefone}?text=${encodeURIComponent(mensagem)}`
</script>
